# ã‚³ãƒ³ãƒ‘ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆãƒ»ã‚½ãƒ•ãƒˆ PsychoPyçµ±åˆ å®Ÿè£…è¨ˆç”»

## æ¦‚è¦

æ—¢å­˜ã®C#ã‚³ãƒ³ãƒ‘ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆãƒ»ã‚½ãƒ•ãƒˆã‚’ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢APIã‚µãƒ¼ãƒãƒ¼åŒ–ã—ã€PsychoPyã‹ã‚‰èª²é¡Œåˆ¶å¾¡ã‚’å¯èƒ½ã«ã™ã‚‹ã€‚ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢åˆ¶å¾¡ãƒ­ã‚¸ãƒƒã‚¯ã¯ãã®ã¾ã¾ç¶­æŒã—ã€èª²é¡Œãƒ­ã‚¸ãƒƒã‚¯ã®ã¿ã‚’Pythonã«ç§»è¡Œã™ã‚‹æ®µéšçš„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã€‚

## ãƒ¦ãƒ¼ã‚¶ãƒ¼æ±ºå®šäº‹é …

- âœ… **åˆ¶å¾¡ç¯„å›²**: èª²é¡Œãƒ­ã‚¸ãƒƒã‚¯å…¨ä½“ï¼ˆå…¥å®¤â†’èª²é¡Œå®Ÿè¡Œâ†’çµ¦é¤Œâ†’é€€å®¤ï¼‰ã‚’PsychoPyã§åˆ¶å¾¡
- âœ… **æ—¢å­˜æ©Ÿèƒ½**: æ®µéšçš„ã«ç½®ãæ›ãˆï¼ˆTraining, DelayMatchç­‰ã‚’å¾ã€…ã«ç§»è¡Œï¼‰
- âœ… **å®Ÿè£…æ–¹æ³•**: REST APIæ–¹å¼ï¼ˆC#ã‚’ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢APIã‚µãƒ¼ãƒãƒ¼åŒ–ï¼‰
- âœ… **ã‚¿ãƒƒãƒãƒ‘ãƒãƒ«è¡¨ç¤º**: PsychoPyã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã§ç›´æ¥è¡¨ç¤º
- âœ… **FormSub**: ExternalControlãƒ¢ãƒ¼ãƒ‰æ™‚ã¯éè¡¨ç¤ºã«ã™ã‚‹
- âœ… **ãƒ‡ãƒ¼ã‚¿è¨˜éŒ²**: C#å´ã§è¨˜éŒ²ï¼ˆæ—¢å­˜CSVãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆç¶­æŒï¼‰
- âœ… **ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰**: ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ãªã—ã§PCå˜ä½“ã§ãƒ‡ãƒ¢å‹•ä½œå¯èƒ½
- âœ… **ã‚·ã‚¹ãƒ†ãƒ è¦æ¨¡**: 5-10ã‚±ãƒ¼ã‚¸ã€1ã‚±ãƒ¼ã‚¸=ç´„4ãƒ‡ãƒã‚¤ã‚¹ã€1ãƒ‡ãƒã‚¤ã‚¹=1PCï¼ˆC#+PsychoPyï¼‰
- âœ… **æ¡ä»¶ä»˜ãã‚·ãƒ¼ã‚±ãƒ³ã‚¹åˆ¶å¾¡**: éƒ¨å±‹Aã‚¯ãƒªã‚¢â†’éƒ¨å±‹Båˆ©ç”¨å¯èƒ½â†’éƒ¨å±‹Cåˆ©ç”¨å¯èƒ½ï¼ˆä»»æ„é †åºè¨­å®šå¯èƒ½ï¼‰
- âœ… **é€šçŸ¥æ©Ÿèƒ½**: æ¬¡ã®èª²é¡ŒãŒåˆ©ç”¨å¯èƒ½ã«ãªã£ãŸéƒ¨å±‹ã§éŸ³ãƒ»å…‰ã«ã‚ˆã‚‹é€šçŸ¥
- âœ… **ã‚ªãƒšãƒ¬ãƒ¼ã‚¿ãƒ¼æ©Ÿèƒ½**: èª²é¡Œé¸æŠã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨­å®šã€é–‹å§‹/åœæ­¢ã€çŠ¶æ…‹ç›£è¦–ã€ãƒ‡ãƒ¼ã‚¿åé›†ã€æ¡ä»¶ä»˜ãã‚·ãƒ¼ã‚±ãƒ³ã‚¹åˆ¶å¾¡

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PsychoPy ã‚¹ã‚¯ãƒªãƒ—ãƒˆ (Python)        â”‚
â”‚  - èª²é¡Œãƒ•ãƒ­ãƒ¼åˆ¶å¾¡                    â”‚
â”‚  - ã‚»ã‚«ãƒ³ãƒ€ãƒªãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ã«è¡¨ç¤º       â”‚
â”‚  - ã‚¿ãƒƒãƒå…¥åŠ›æ¤œå‡º                    â”‚
â”‚  - compartment_hardware.py ä½¿ç”¨     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ HTTP REST API
               â”‚ (localhost:5000)
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  C# Web API ã‚µãƒ¼ãƒãƒ¼                 â”‚
â”‚  - ASP.NET Core (æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ)   â”‚
â”‚  - ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢åˆ¶å¾¡APIã‚’å…¬é–‹          â”‚
â”‚  - FormMainã¨å…±å­˜                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ—¢å­˜ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢åˆ¶å¾¡                 â”‚
â”‚  - DevDoor, DevLever, DevFeed...    â”‚
â”‚  - IoBoardBase (IoMicrochip)        â”‚
â”‚  - ã‚»ãƒ³ã‚µãƒ¼ã€RFID                    â”‚
â”‚  (å¤‰æ›´ãªã—)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰è¨­è¨ˆ

### æ¦‚è¦

ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã‚’æ¥ç¶šã›ãšã«PCå˜ä½“ã§ãƒ‡ãƒ¢å‹•ä½œå¯èƒ½ãªãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ã‚’è¿½åŠ ã€‚æ—¢å­˜ã®`IoMicrochipDummy`ã‚’æ‹¡å¼µã—ã€APIçµŒç”±ã§ã‚»ãƒ³ã‚µãƒ¼çŠ¶æ…‹ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆå¯èƒ½ã«ã™ã‚‹ã€‚

### ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ã®ç‰¹å¾´

- âœ… **å®Œå…¨ãƒ€ãƒŸãƒ¼ãƒ¢ãƒ¼ãƒ‰**: ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ä¸è¦ã§PCã®ã¿ã§å‹•ä½œ
- âœ… **ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ãƒ¢ãƒ¼ãƒ‰**: å®Ÿæ©Ÿä½¿ç”¨ï¼‹åˆ¶å¾¡å›°é›£ãªéƒ¨åˆ†ã®ã¿æ‰‹å‹•ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
- âœ… ã‚»ãƒ³ã‚µãƒ¼ã”ã¨ã«ã€Œå®Ÿæ©Ÿ/æ‰‹å‹•ã€ã‚’åˆ‡ã‚Šæ›¿ãˆå¯èƒ½
- âœ… APIçµŒç”±ã§ã‚»ãƒ³ã‚µãƒ¼çŠ¶æ…‹ã‚’è¨­å®šå¯èƒ½
- âœ… PsychoPyå´ã‹ã‚‰ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã§ã‚»ãƒ³ã‚µãƒ¼ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
- âœ… ãƒ€ãƒŸãƒ¼RFIDå€¤ã‚’ç”Ÿæˆãƒ»è¨­å®šå¯èƒ½
- âœ… ãƒ‡ãƒãƒƒã‚°ãƒ‘ãƒãƒ«ã§çŠ¶æ…‹ã‚’å¯è¦–åŒ–

### å®Ÿè£…æ–¹é‡

#### 1. ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰IOãƒœãƒ¼ãƒ‰ï¼ˆIoHybridBoardï¼‰

å®Ÿæ©Ÿã¨ãƒ€ãƒŸãƒ¼ã‚’çµ„ã¿åˆã‚ã›ã€ã‚»ãƒ³ã‚µãƒ¼ã”ã¨ã«åˆ‡ã‚Šæ›¿ãˆå¯èƒ½ãªãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰IOãƒœãƒ¼ãƒ‰ï¼š

```csharp
public class IoHybridBoard : IoBoardBase
{
    private IoBoardBase realBoard;      // å®Ÿæ©Ÿï¼ˆIoMicrochipï¼‰
    private IoBoardBase dummyBoard;     // ãƒ€ãƒŸãƒ¼ï¼ˆIoMicrochipDummyExï¼‰

    // ã‚»ãƒ³ã‚µãƒ¼ã”ã¨ã®ãƒ¢ãƒ¼ãƒ‰è¨­å®šï¼ˆtrue=æ‰‹å‹•ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã€false=å®Ÿæ©Ÿï¼‰
    private Dictionary<IoBoardDInLogicalName, bool> sensorOverrides = new Dictionary<IoBoardDInLogicalName, bool>
    {
        { IoBoardDInLogicalName.RoomEntrance, true },  // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼šæ‰‹å‹•
        { IoBoardDInLogicalName.RoomExit, true },      // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼šæ‰‹å‹•
        { IoBoardDInLogicalName.RoomStay, false },     // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼šå®Ÿæ©Ÿ
        { IoBoardDInLogicalName.DoorOpen, false },     // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼šå®Ÿæ©Ÿ
        { IoBoardDInLogicalName.DoorClose, false },    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼šå®Ÿæ©Ÿ
        { IoBoardDInLogicalName.LeverIn, false },      // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼šå®Ÿæ©Ÿ
        { IoBoardDInLogicalName.LeverOut, false },     // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼šå®Ÿæ©Ÿ
        { IoBoardDInLogicalName.LeverSw, false }       // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼šå®Ÿæ©Ÿ
    };

    // æ‰‹å‹•ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆç”¨ã®ã‚»ãƒ³ã‚µãƒ¼çŠ¶æ…‹
    private Dictionary<IoBoardDInLogicalName, bool> manualSensorStates = new Dictionary<IoBoardDInLogicalName, bool>();

    public IoHybridBoard(bool useRealHardware)
    {
        // å®Ÿæ©Ÿã‚’è©¦è¡Œ
        if (useRealHardware)
        {
            realBoard = new IoMicrochip();
            if (!realBoard.AcquireDevice())
            {
                realBoard = null;  // æ¥ç¶šå¤±æ•—æ™‚ã¯null
            }
        }

        // ãƒ€ãƒŸãƒ¼ã¯å¸¸ã«æº–å‚™
        dummyBoard = new IoMicrochipDummyEx();
        dummyBoard.AcquireDevice();
    }

    // ã‚»ãƒ³ã‚µãƒ¼ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰è¨­å®š
    public void SetSensorOverride(IoBoardDInLogicalName sensor, bool useManual)
    {
        sensorOverrides[sensor] = useManual;
    }

    // æ‰‹å‹•ã§ã‚»ãƒ³ã‚µãƒ¼çŠ¶æ…‹ã‚’è¨­å®š
    public void SetManualSensorState(IoBoardDInLogicalName sensor, bool state)
    {
        lock (manualSensorStates)
        {
            manualSensorStates[sensor] = state;
        }
    }

    public override bool GetUpperStateOfSaveDIn(IoBoardDInLogicalName logicalName, out bool logicalState)
    {
        // ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰è¨­å®šã‚’ç¢ºèª
        if (sensorOverrides.ContainsKey(logicalName) && sensorOverrides[logicalName])
        {
            // æ‰‹å‹•ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆãƒ¢ãƒ¼ãƒ‰
            lock (manualSensorStates)
            {
                logicalState = manualSensorStates.ContainsKey(logicalName)
                    ? manualSensorStates[logicalName]
                    : false;
            }
            return true;
        }
        else
        {
            // å®Ÿæ©Ÿãƒ¢ãƒ¼ãƒ‰
            if (realBoard != null)
            {
                return realBoard.GetUpperStateOfSaveDIn(logicalName, out logicalState);
            }
            else
            {
                // å®Ÿæ©Ÿãªã—æ™‚ã¯ãƒ€ãƒŸãƒ¼ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
                return dummyBoard.GetUpperStateOfSaveDIn(logicalName, out logicalState);
            }
        }
    }

    // å‡ºåŠ›åˆ¶å¾¡ã¯å¸¸ã«å®Ÿæ©Ÿå„ªå…ˆï¼ˆã¾ãŸã¯å…¨ã¦ãƒ€ãƒŸãƒ¼ï¼‰
    public override bool SetUpperStateOfDOut(IoBoardDOutLogicalName logicalName)
    {
        if (realBoard != null)
        {
            return realBoard.SetUpperStateOfDOut(logicalName);
        }
        else
        {
            return dummyBoard.SetUpperStateOfDOut(logicalName);
        }
    }

    // å®Ÿæ©Ÿæ¥ç¶šçŠ¶æ…‹ã‚’å–å¾—
    public bool IsRealHardwareConnected => realBoard != null;
}
```

#### 1-2. å®Œå…¨ãƒ€ãƒŸãƒ¼IOãƒœãƒ¼ãƒ‰ï¼ˆIoMicrochipDummyExï¼‰

å®Ÿæ©Ÿãªã—ã§å®Œå…¨å‹•ä½œã™ã‚‹ãƒ€ãƒŸãƒ¼ï¼ˆæ—¢å­˜ã®IoMicrochipDummyã‚’æ‹¡å¼µï¼‰ï¼š

```csharp
public class IoMicrochipDummyEx : IoBoardBase
{
    // ï¼ˆå‰è¿°ã®ãƒ€ãƒŸãƒ¼å®Ÿè£…ï¼‰
    // ã‚»ãƒ³ã‚µãƒ¼çŠ¶æ…‹ã‚’ä¿æŒã—ã€ãƒ‡ãƒã‚¤ã‚¹ã‚³ãƒãƒ³ãƒ‰ã§è‡ªå‹•æ›´æ–°
}
```

#### 2. ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰è¨­å®š

**Preferencesç”»é¢ã«è¿½åŠ **:
- ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã€ŒEnable Debug Modeã€
- ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³:
  - ã€Œå®Œå…¨ãƒ€ãƒŸãƒ¼ï¼ˆå®Ÿæ©Ÿä¸è¦ï¼‰ã€
  - ã€Œãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ï¼ˆå®Ÿæ©Ÿï¼‹æ‰‹å‹•ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆï¼‰ã€â† **æ¨å¥¨**

**FormMain.csã®åˆæœŸåŒ–**:
```csharp
private void InitializeIoBoard()
{
    if (preferencesDatOriginal.EnableDebugMode)
    {
        if (preferencesDatOriginal.DebugModeType == DebugModeType.FullDummy)
        {
            // å®Œå…¨ãƒ€ãƒŸãƒ¼
            ioBoardDevice = new IoMicrochipDummyEx();
        }
        else if (preferencesDatOriginal.DebugModeType == DebugModeType.Hybrid)
        {
            // ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ï¼ˆå®Ÿæ©Ÿã‚ã‚Œã°ä½¿ç”¨ã€åˆ¶å¾¡å›°é›£ãªéƒ¨åˆ†ã®ã¿æ‰‹å‹•ï¼‰
            ioBoardDevice = new IoHybridBoard(useRealHardware: true);
        }

        // RFIDèª­ã¿å–ã‚Šã¯ãƒ€ãƒŸãƒ¼åŒ–ï¼ˆæ‰‹å‹•è¨­å®šå¯èƒ½ï¼‰
        rfidReader = new RFIDReaderDummy();
    }
    else
    {
        // é€šå¸¸ãƒ¢ãƒ¼ãƒ‰ï¼ˆå®Ÿæ©Ÿã®ã¿ï¼‰
        ioBoardDevice = new IoMicrochip();
        rfidReader = new RFIDReaderHelper();
    }
}
```

#### 3. ãƒ‡ãƒãƒƒã‚°å°‚ç”¨API

**æ–°ã—ã„ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼: `DebugController.cs`**

```csharp
[ApiController]
[Route("api/debug")]
public class DebugController : ControllerBase
{
    private readonly HardwareService _hardwareService;

    // ã‚»ãƒ³ã‚µãƒ¼çŠ¶æ…‹ã‚’è¨­å®š
    [HttpPost("sensor/set")]
    public IActionResult SetSensor([FromBody] SetSensorRequest req)
    {
        // req.sensor = "entrance", req.state = true
        _hardwareService.SetDebugSensorState(req.sensor, req.state);
        return Ok(new { success = true });
    }

    // RFIDå€¤ã‚’è¨­å®š
    [HttpPost("rfid/set")]
    public IActionResult SetRFID([FromBody] SetRFIDRequest req)
    {
        // req.id = "1234567890123456"
        _hardwareService.SetDebugRFID(req.id);
        return Ok(new { success = true });
    }

    // ã™ã¹ã¦ã®ã‚»ãƒ³ã‚µãƒ¼çŠ¶æ…‹ã‚’å–å¾—
    [HttpGet("sensors/all")]
    public IActionResult GetAllSensors()
    {
        var states = _hardwareService.GetAllDebugSensorStates();
        return Ok(states);
    }

    // ãƒ‡ãƒã‚¤ã‚¹çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
    [HttpPost("reset")]
    public IActionResult Reset()
    {
        _hardwareService.ResetDebugState();
        return Ok(new { success = true });
    }
}
```

#### 4. PsychoPyå´ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½

**ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆcompartment_hardware.pyæ‹¡å¼µï¼‰**:

```python
class CompartmentHardware:
    def __init__(self, base_url="http://localhost:5000/api", debug_mode=False):
        self.base_url = base_url
        self.debug_mode = debug_mode

    # ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰å°‚ç”¨ãƒ¡ã‚½ãƒƒãƒ‰
    def debug_set_sensor(self, sensor_name: str, state: bool) -> bool:
        """ãƒ‡ãƒãƒƒã‚°: ã‚»ãƒ³ã‚µãƒ¼çŠ¶æ…‹ã‚’è¨­å®š"""
        if not self.debug_mode:
            print("Warning: debug_set_sensor called in non-debug mode")
            return False

        try:
            response = requests.post(
                f"{self.base_url}/debug/sensor/set",
                json={"sensor": sensor_name, "state": state},
                timeout=self.timeout
            )
            response.raise_for_status()
            return response.json()["success"]
        except Exception as e:
            print(f"Error setting debug sensor: {e}")
            return False

    def debug_set_rfid(self, rfid_id: str) -> bool:
        """ãƒ‡ãƒãƒƒã‚°: RFIDå€¤ã‚’è¨­å®š"""
        if not self.debug_mode:
            return False

        try:
            response = requests.post(
                f"{self.base_url}/debug/rfid/set",
                json={"id": rfid_id},
                timeout=self.timeout
            )
            response.raise_for_status()
            return response.json()["success"]
        except Exception as e:
            print(f"Error setting debug RFID: {e}")
            return False

    def debug_simulate_entrance(self) -> bool:
        """ãƒ‡ãƒãƒƒã‚°: å…¥å®¤ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ"""
        return self.debug_set_sensor("entrance", True)

    def debug_simulate_exit(self) -> bool:
        """ãƒ‡ãƒãƒƒã‚°: é€€å®¤ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ"""
        return self.debug_set_sensor("exit", True)
```

**ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒ¢ãƒ¼ãƒ‰**:

```python
# debug_keyboard_control.py
from psychopy import event, core
from compartment_hardware import CompartmentHardware

hw = CompartmentHardware(debug_mode=True)

print("=== ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ ===")
print("ã‚­ãƒ¼æ“ä½œ:")
print("  E: å…¥å®¤ã‚»ãƒ³ã‚µãƒ¼ON")
print("  X: é€€å®¤ã‚»ãƒ³ã‚µãƒ¼ON")
print("  R: RFIDèª­ã¿å–ã‚Šã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ")
print("  D: ãƒ‰ã‚¢é–‹ã")
print("  C: ãƒ‰ã‚¢é–‰ã˜ã‚‹")
print("  ESC: çµ‚äº†")

while True:
    keys = event.getKeys()

    if 'escape' in keys:
        break
    elif 'e' in keys:
        print("å…¥å®¤ã‚»ãƒ³ã‚µãƒ¼ ON")
        hw.debug_set_sensor("entrance", True)
        core.wait(0.5)
        hw.debug_set_sensor("entrance", False)
    elif 'x' in keys:
        print("é€€å®¤ã‚»ãƒ³ã‚µãƒ¼ ON")
        hw.debug_set_sensor("exit", True)
        core.wait(0.5)
        hw.debug_set_sensor("exit", False)
    elif 'r' in keys:
        import random
        rfid = f"{random.randint(1000000000000000, 9999999999999999)}"
        print(f"RFID: {rfid}")
        hw.debug_set_rfid(rfid)
    elif 'd' in keys:
        print("ãƒ‰ã‚¢ã‚’é–‹ã")
        hw.open_door()
    elif 'c' in keys:
        print("ãƒ‰ã‚¢ã‚’é–‰ã˜ã‚‹")
        hw.close_door()

    core.wait(0.01)
```

#### 5. ãƒ‡ãƒãƒƒã‚°ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ«ï¼ˆC# GUIï¼‰

**ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰æ™‚ã®ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤æ§‹æˆ**:
- **ã‚»ã‚«ãƒ³ãƒ€ãƒªãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤**: PsychoPyã®èª²é¡Œç”»é¢ï¼ˆã‚¿ãƒƒãƒãƒ‘ãƒãƒ«ä»£ã‚ã‚Šï¼‰
- **ãƒ¡ã‚¤ãƒ³ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ï¼ˆãƒãƒ¼ãƒˆPCï¼‰**: FormMainã«ãƒ‡ãƒãƒƒã‚°ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ«è¡¨ç¤º

**æ–°ã—ã„UserControl: `UserControlDebugPanel.cs`**

FormMainã«è¿½åŠ ã™ã‚‹ãƒ‡ãƒãƒƒã‚°ãƒ‘ãƒãƒ«ã€‚ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰æ™‚ã®ã¿è¡¨ç¤ºã€‚

```csharp
public partial class UserControlDebugPanel : UserControl
{
    private IoMicrochipDummyEx dummyIoBoard;

    // UIè¦ç´ :
    // - ã‚»ãƒ³ã‚µãƒ¼çŠ¶æ…‹è¡¨ç¤ºï¼ˆLEDé¢¨ï¼‰
    // - ã‚»ãƒ³ã‚µãƒ¼ON/OFFãƒœã‚¿ãƒ³
    // - RFIDå…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
    // - ãƒ‡ãƒã‚¤ã‚¹çŠ¶æ…‹è¡¨ç¤º
    // - ãƒ­ã‚°å‡ºåŠ›ã‚¨ãƒªã‚¢
}
```

**ãƒ‘ãƒãƒ«ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼ˆãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ãƒ¢ãƒ¼ãƒ‰å¯¾å¿œï¼‰**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ãƒ‡ãƒãƒƒã‚°ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ«  [ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ãƒ¢ãƒ¼ãƒ‰] â”‚
â”‚ å®Ÿæ©Ÿæ¥ç¶š: â— æ¥ç¶šä¸­                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [ã‚»ãƒ³ã‚µãƒ¼ - æ‰‹å‹•ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ]                   â”‚
â”‚  â— å…¥å®¤ã‚»ãƒ³ã‚µãƒ¼ [ON] [OFF] â—‹ OFF  [â˜‘æ‰‹å‹•]    â”‚
â”‚  â— é€€å®¤ã‚»ãƒ³ã‚µãƒ¼ [ON] [OFF] â—‹ OFF  [â˜‘æ‰‹å‹•]    â”‚
â”‚  â— åœ¨å®¤ã‚»ãƒ³ã‚µãƒ¼              â— OFF  [â˜å®Ÿæ©Ÿ]    â”‚
â”‚  â— ãƒ¬ãƒãƒ¼SW                  â—‹ OFF  [â˜å®Ÿæ©Ÿ]    â”‚
â”‚                                                 â”‚
â”‚ [ãƒ‡ãƒã‚¤ã‚¹çŠ¶æ…‹ - å®Ÿæ©Ÿã‹ã‚‰å–å¾—]                   â”‚
â”‚  ãƒ‰ã‚¢:    â—‹ Open  â— Close  (å®Ÿæ©Ÿã‚»ãƒ³ã‚µãƒ¼)      â”‚
â”‚  ãƒ¬ãƒãƒ¼:  â— In    â—‹ Out    (å®Ÿæ©Ÿã‚»ãƒ³ã‚µãƒ¼)      â”‚
â”‚  çµ¦é¤Œä¸­:  â—‹ çµ¦é¤Œä¸­ã§ã¯ã‚ã‚Šã¾ã›ã‚“                â”‚
â”‚                                                 â”‚
â”‚ [RFID - æ‰‹å‹•è¨­å®š]                               â”‚
â”‚  ID: [1234567890123456] [ãƒ©ãƒ³ãƒ€ãƒ ç”Ÿæˆ]         â”‚
â”‚      [è¨­å®š] [ã‚¯ãƒªã‚¢]                            â”‚
â”‚                                                 â”‚
â”‚ [ãƒ­ã‚°]                                          â”‚
â”‚  12:34:56 - [æ‰‹å‹•] å…¥å®¤ã‚»ãƒ³ã‚µãƒ¼ ON             â”‚
â”‚  12:34:57 - [æ‰‹å‹•] RFIDè¨­å®š: 1234...           â”‚
â”‚  12:34:58 - [å®Ÿæ©Ÿ] ãƒ‰ã‚¢é–‰ã˜ã‚‹                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®æ„å‘³**:
- â˜‘æ‰‹å‹•: ã“ã®ã‚»ãƒ³ã‚µãƒ¼ã¯æ‰‹å‹•ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆï¼ˆãƒœã‚¿ãƒ³ã§ON/OFFï¼‰
- â˜å®Ÿæ©Ÿ: ã“ã®ã‚»ãƒ³ã‚µãƒ¼ã¯å®Ÿæ©Ÿã‹ã‚‰èª­ã¿å–ã‚Š

**å®Ÿè£…è©³ç´°**:

```csharp
// UserControlDebugPanel.Designer.cs
partial class UserControlDebugPanel
{
    // ã‚»ãƒ³ã‚µãƒ¼ãƒœã‚¿ãƒ³
    private Button buttonEntranceOn;
    private Button buttonEntranceOff;
    private Label labelEntranceStatus;  // LEDè¡¨ç¤º

    private Button buttonExitOn;
    private Button buttonExitOff;
    private Label labelExitStatus;

    // RFID
    private TextBox textBoxRFID;
    private Button buttonRFIDSet;
    private Button buttonRFIDRandom;

    // ãƒ‡ãƒã‚¤ã‚¹çŠ¶æ…‹è¡¨ç¤º
    private Label labelDoorStatus;
    private Label labelLeverStatus;
    private Label labelFeedingStatus;

    // ãƒ­ã‚°
    private TextBox textBoxLog;
}

// UserControlDebugPanel.cs
public partial class UserControlDebugPanel : UserControl
{
    private IoMicrochipDummyEx dummyIoBoard;
    private FormMain formMain;

    public UserControlDebugPanel(FormMain parent, IoMicrochipDummyEx dummyBoard)
    {
        InitializeComponent();
        formMain = parent;
        dummyIoBoard = dummyBoard;

        // ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ç™»éŒ²
        buttonEntranceOn.Click += (s, e) => SetSensor(IoBoardDInLogicalName.RoomEntrance, true);
        buttonEntranceOff.Click += (s, e) => SetSensor(IoBoardDInLogicalName.RoomEntrance, false);
        // ... ä»–ã®ã‚»ãƒ³ã‚µãƒ¼ã‚‚åŒæ§˜

        buttonRFIDSet.Click += ButtonRFIDSet_Click;
        buttonRFIDRandom.Click += ButtonRFIDRandom_Click;

        // çŠ¶æ…‹æ›´æ–°ã‚¿ã‚¤ãƒãƒ¼ï¼ˆ100mså‘¨æœŸï¼‰
        var timer = new Timer { Interval = 100 };
        timer.Tick += UpdateDisplay;
        timer.Start();
    }

    private void SetSensor(IoBoardDInLogicalName sensor, bool state)
    {
        dummyIoBoard.SetSensorState(sensor, state);
        AddLog($"{sensor.GetEnumDisplayName()} {(state ? "ON" : "OFF")}");
    }

    private void ButtonRFIDSet_Click(object sender, EventArgs e)
    {
        string rfid = textBoxRFID.Text;
        if (formMain.RFIDReaderHelper is RFIDReaderDummy dummy)
        {
            dummy.SetRFID(rfid);
            AddLog($"RFIDè¨­å®š: {rfid}");
        }
    }

    private void ButtonRFIDRandom_Click(object sender, EventArgs e)
    {
        var random = new Random();
        string rfid = random.Next(1000000000, int.MaxValue).ToString() +
                      random.Next(1000000, 9999999).ToString();
        textBoxRFID.Text = rfid;
    }

    private void UpdateDisplay(object sender, EventArgs e)
    {
        // ã‚»ãƒ³ã‚µãƒ¼çŠ¶æ…‹æ›´æ–°ï¼ˆå®Ÿæ©Ÿ or æ‰‹å‹•ï¼‰
        ioBoard.GetUpperStateOfSaveDIn(IoBoardDInLogicalName.RoomEntrance, out bool entrance);
        labelEntranceStatus.BackColor = entrance ? Color.Green : Color.Gray;

        ioBoard.GetUpperStateOfSaveDIn(IoBoardDInLogicalName.RoomExit, out bool exit);
        labelExitStatus.BackColor = exit ? Color.Green : Color.Gray;

        // ãƒ‡ãƒã‚¤ã‚¹çŠ¶æ…‹æ›´æ–°ï¼ˆå®Ÿæ©Ÿã‹ã‚‰å–å¾—ï¼‰
        ioBoard.GetUpperStateOfSaveDIn(IoBoardDInLogicalName.DoorOpen, out bool doorOpen);
        ioBoard.GetUpperStateOfSaveDIn(IoBoardDInLogicalName.DoorClose, out bool doorClose);
        if (doorOpen)
            labelDoorStatus.Text = "â— Open (å®Ÿæ©Ÿ)";
        else if (doorClose)
            labelDoorStatus.Text = "â— Close (å®Ÿæ©Ÿ)";
        else
            labelDoorStatus.Text = "â—‹ ä¸æ˜";

        ioBoard.GetUpperStateOfSaveDIn(IoBoardDInLogicalName.LeverOut, out bool leverOut);
        ioBoard.GetUpperStateOfSaveDIn(IoBoardDInLogicalName.LeverIn, out bool leverIn);
        if (leverOut)
            labelLeverStatus.Text = "â—‹ Out (å®Ÿæ©Ÿ)";
        else if (leverIn)
            labelLeverStatus.Text = "â— In (å®Ÿæ©Ÿ)";
        else
            labelLeverStatus.Text = "â—‹ ä¸æ˜";

        labelFeedingStatus.Text = formMain.Feeding ? "â— çµ¦é¤Œä¸­" : "â—‹ çµ¦é¤Œä¸­ã§ã¯ã‚ã‚Šã¾ã›ã‚“";
    }

    private void AddLog(string message)
    {
        textBoxLog.AppendText($"{DateTime.Now:HH:mm:ss} - {message}\r\n");
    }
}
```

**FormMainã¸ã®çµ±åˆ**:

```csharp
// FormMain.cs
private UserControlDebugPanel userControlDebugPanel;

private void FormMain_Load(object sender, EventArgs e)
{
    // ... æ—¢å­˜ã®åˆæœŸåŒ–

    // IOãƒœãƒ¼ãƒ‰åˆæœŸåŒ–
    InitializeIoBoard();

    // ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰æ™‚ã®ã¿ãƒ‘ãƒãƒ«è¡¨ç¤º
    if (preferencesDatOriginal.EnableDebugMode)
    {
        userControlDebugPanel = new UserControlDebugPanel(this, ioBoardDevice);
        userControlDebugPanel.Dock = DockStyle.Right;  // å³å´ã«é…ç½®
        userControlDebugPanel.Width = 450;
        this.Controls.Add(userControlDebugPanel);
        userControlDebugPanel.BringToFront();
    }
}
```

**ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆè¿½åŠ **:

ãƒ‡ãƒãƒƒã‚°ãƒ‘ãƒãƒ«ã«ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚’è¿½åŠ ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰:
- `E`: å…¥å®¤ã‚»ãƒ³ã‚µãƒ¼ONï¼ˆ500mså¾Œã«è‡ªå‹•OFFï¼‰
- `X`: é€€å®¤ã‚»ãƒ³ã‚µãƒ¼ONï¼ˆ500mså¾Œã«è‡ªå‹•OFFï¼‰
- `R`: ãƒ©ãƒ³ãƒ€ãƒ RFIDç”Ÿæˆ
- `D`: ãƒ‰ã‚¢é–‹ã/é–‰ã˜ã‚‹ãƒˆã‚°ãƒ«
- `L`: ãƒ¬ãƒãƒ¼å‡ºã™/å¼•ã£è¾¼ã‚ã‚‹ãƒˆã‚°ãƒ«

```csharp
protected override bool ProcessCmdKey(ref Message msg, Keys keyData)
{
    if (!preferencesDatOriginal.EnableDebugMode)
        return base.ProcessCmdKey(ref msg, keyData);

    switch (keyData)
    {
        case Keys.E:
            userControlDebugPanel.SimulateEntrancePulse();
            return true;
        case Keys.X:
            userControlDebugPanel.SimulateExitPulse();
            return true;
        // ... ä»–ã®ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ
    }
    return base.ProcessCmdKey(ref msg, keyData);
}
```

### ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ã®ãƒ¡ãƒªãƒƒãƒˆ

1. **é–‹ç™ºåŠ¹ç‡**: ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ãªã—ã§ã‚³ãƒ¼ãƒ‰é–‹ç™ºãƒ»ãƒ†ã‚¹ãƒˆå¯èƒ½
2. **ãƒ‡ãƒ¢**: ãƒ—ãƒ¬ã‚¼ãƒ³ã‚„èª¬æ˜æ™‚ã«å®Ÿæ©Ÿä¸è¦
3. **æ•™è‚²**: å­¦ç”Ÿã‚„æ–°è¦ãƒ¡ãƒ³ãƒãƒ¼ã®ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã«ä½¿ç”¨
4. **CI/CD**: è‡ªå‹•ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ä½¿ç”¨å¯èƒ½
5. **ãƒªãƒ¢ãƒ¼ãƒˆé–‹ç™º**: åœ¨å®…å‹¤å‹™æ™‚ã§ã‚‚é–‹ç™ºç¶™ç¶š
6. **å¯è¦–åŒ–**: ãƒ¡ã‚¤ãƒ³ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ã§æ©Ÿå™¨çŠ¶æ…‹ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç¢ºèª
7. **ç°¡æ˜“æ“ä½œ**: ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ã§æ“¬ä¼¼çš„ã«å‹•ç‰©ã®è¡Œå‹•ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ

## æ¡ä»¶ä»˜ãã‚·ãƒ¼ã‚±ãƒ³ã‚¹åˆ¶å¾¡ï¼ˆå¤šéƒ¨å±‹é€£æºï¼‰

### æ¦‚è¦

è¤‡æ•°ã®éƒ¨å±‹ã§é€£é–çš„ãªèª²é¡Œã‚’å®Ÿæ–½ã™ã‚‹æ©Ÿèƒ½ã€‚éƒ¨å±‹Aã®èª²é¡ŒãŒå®Œäº†ã—ãŸã‚‰éƒ¨å±‹BãŒåˆ©ç”¨å¯èƒ½ã«ãªã‚Šã€éƒ¨å±‹BãŒå®Œäº†ã—ãŸã‚‰éƒ¨å±‹CãŒåˆ©ç”¨å¯èƒ½ã«ãªã‚‹ã€ã¨ã„ã£ãŸæ¡ä»¶ä»˜ãã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã‚’è¨­å®šå¯èƒ½ã€‚

### ä¸»è¦æ©Ÿèƒ½

#### 1. ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å®šç¾©

ã‚ªãƒšãƒ¬ãƒ¼ã‚¿ãƒ¼ãŒéƒ¨å±‹ã®é †åºã‚’ä»»æ„ã«è¨­å®šï¼š

```json
{
  "sequenceId": "seq_001",
  "name": "3éƒ¨å±‹é€£æºèª²é¡Œ",
  "rooms": [
    {
      "order": 1,
      "roomId": "room1",
      "taskType": "training",
      "requiredTrials": 10,
      "notifyOnAvailable": true
    },
    {
      "order": 2,
      "roomId": "room3",
      "taskType": "delaymatch",
      "requiredTrials": 20,
      "notifyOnAvailable": true
    },
    {
      "order": 3,
      "roomId": "room2",
      "taskType": "reversal",
      "requiredTrials": 15,
      "notifyOnAvailable": true
    }
  ]
}
```

**ç‰¹å¾´**:
- éƒ¨å±‹ã®é †åºã¯ä»»æ„ï¼ˆroom1â†’room3â†’room2ãªã©ï¼‰
- å„ã‚¹ãƒ†ãƒƒãƒ—ã§å®Œäº†æ¡ä»¶ã‚’è¨­å®šï¼ˆè©¦è¡Œå›æ•°ã€æ­£ç­”ç‡ãªã©ï¼‰
- æ¬¡ã®éƒ¨å±‹ã§éŸ³ãƒ»å…‰ã«ã‚ˆã‚‹é€šçŸ¥ã®æœ‰ç„¡ã‚’è¨­å®š

#### 2. çŠ¶æ…‹ç®¡ç†

ä¸­å¤®ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ãŒã‚·ãƒ¼ã‚±ãƒ³ã‚¹å…¨ä½“ã®çŠ¶æ…‹ã‚’ç®¡ç†ï¼š

```python
# central_orchestrator/sequence_manager.py
from enum import Enum
from dataclasses import dataclass
from typing import List, Dict, Optional

class RoomStatus(Enum):
    LOCKED = "locked"           # ã¾ã åˆ©ç”¨ä¸å¯
    AVAILABLE = "available"     # åˆ©ç”¨å¯èƒ½ï¼ˆå‹•ç‰©ãŒå…¥å®¤å¯èƒ½ï¼‰
    IN_PROGRESS = "in_progress" # èª²é¡Œå®Ÿè¡Œä¸­
    COMPLETED = "completed"     # å®Œäº†

@dataclass
class RoomStep:
    order: int
    room_id: str
    task_type: str
    required_trials: int
    notify_on_available: bool
    status: RoomStatus = RoomStatus.LOCKED
    completed_trials: int = 0

@dataclass
class Sequence:
    sequence_id: str
    name: str
    rooms: List[RoomStep]
    current_step: int = 0

    def get_current_room(self) -> Optional[RoomStep]:
        if self.current_step < len(self.rooms):
            return self.rooms[self.current_step]
        return None

    def get_next_room(self) -> Optional[RoomStep]:
        if self.current_step + 1 < len(self.rooms):
            return self.rooms[self.current_step + 1]
        return None

class SequenceManager:
    def __init__(self):
        self.sequences: Dict[str, Sequence] = {}

    async def start_sequence(self, sequence: Sequence):
        """ã‚·ãƒ¼ã‚±ãƒ³ã‚¹é–‹å§‹ - æœ€åˆã®éƒ¨å±‹ã‚’AVAILABLEã«"""
        sequence.rooms[0].status = RoomStatus.AVAILABLE
        if sequence.rooms[0].notify_on_available:
            await self.notify_room(sequence.rooms[0].room_id)
        self.sequences[sequence.sequence_id] = sequence

    async def on_trial_completed(self, room_id: str, sequence_id: str):
        """è©¦è¡Œå®Œäº†æ™‚ã®å‡¦ç†"""
        sequence = self.sequences.get(sequence_id)
        if not sequence:
            return

        current_room = sequence.get_current_room()
        if current_room.room_id != room_id:
            return

        current_room.completed_trials += 1

        # å¿…è¦è©¦è¡Œæ•°ã«åˆ°é”ã—ãŸã‚‰ã‚¹ãƒ†ãƒƒãƒ—å®Œäº†
        if current_room.completed_trials >= current_room.required_trials:
            current_room.status = RoomStatus.COMPLETED
            await self.advance_to_next_room(sequence)

    async def advance_to_next_room(self, sequence: Sequence):
        """æ¬¡ã®éƒ¨å±‹ã«é€²ã‚€"""
        sequence.current_step += 1
        next_room = sequence.get_current_room()

        if next_room:
            # æ¬¡ã®éƒ¨å±‹ã‚’åˆ©ç”¨å¯èƒ½ã«
            next_room.status = RoomStatus.AVAILABLE

            # é€šçŸ¥ãŒæœ‰åŠ¹ãªã‚‰éŸ³ãƒ»å…‰ã‚’é³´ã‚‰ã™
            if next_room.notify_on_available:
                await self.notify_room(next_room.room_id)
        else:
            # ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å®Œäº†
            print(f"Sequence {sequence.sequence_id} completed!")

    async def notify_room(self, room_id: str):
        """éƒ¨å±‹ã§éŸ³ãƒ»å…‰ã«ã‚ˆã‚‹é€šçŸ¥"""
        room_url = ROOMS[room_id]["url"]
        async with httpx.AsyncClient() as client:
            # ãƒ«ãƒ¼ãƒ ãƒ©ãƒ³ãƒ—ON
            await client.post(f"{room_url}/room/lamp", json={"on": True})
            # éŸ³ã‚’é³´ã‚‰ã™
            await client.post(f"{room_url}/sound/play", json={
                "file": "/sounds/notification.wav",
                "durationMs": 1000
            })
            # 3ç§’å¾Œã«ãƒ©ãƒ³ãƒ—OFF
            await asyncio.sleep(3)
            await client.post(f"{room_url}/room/lamp", json={"on": False})
```

#### 3. ä¸­å¤®ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

**ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ç®¡ç†API**:

```python
# central_orchestrator/main.py

sequence_manager = SequenceManager()

@app.post("/sequences/create")
async def create_sequence(sequence: Sequence):
    """æ–°ã—ã„ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã‚’ä½œæˆ"""
    await sequence_manager.start_sequence(sequence)
    return {"success": True, "sequenceId": sequence.sequence_id}

@app.get("/sequences/{sequence_id}/status")
async def get_sequence_status(sequence_id: str):
    """ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã®ç¾åœ¨çŠ¶æ…‹ã‚’å–å¾—"""
    sequence = sequence_manager.sequences.get(sequence_id)
    if not sequence:
        return {"error": "Sequence not found"}

    return {
        "sequenceId": sequence.sequence_id,
        "name": sequence.name,
        "currentStep": sequence.current_step,
        "totalSteps": len(sequence.rooms),
        "rooms": [
            {
                "order": room.order,
                "roomId": room.room_id,
                "taskType": room.task_type,
                "status": room.status.value,
                "completedTrials": room.completed_trials,
                "requiredTrials": room.required_trials
            }
            for room in sequence.rooms
        ]
    }

@app.post("/sequences/{sequence_id}/trial_completed")
async def trial_completed(sequence_id: str, room_id: str):
    """è©¦è¡Œå®Œäº†ã‚’é€šçŸ¥ï¼ˆå„éƒ¨å±‹ã®C# APIã‹ã‚‰å‘¼ã°ã‚Œã‚‹ï¼‰"""
    await sequence_manager.on_trial_completed(room_id, sequence_id)
    return {"success": True}

@app.get("/rooms/{room_id}/sequence_status")
async def get_room_sequence_status(room_id: str):
    """ç‰¹å®šéƒ¨å±‹ãŒã©ã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã«å«ã¾ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª"""
    for sequence in sequence_manager.sequences.values():
        for room in sequence.rooms:
            if room.room_id == room_id:
                return {
                    "sequenceId": sequence.sequence_id,
                    "status": room.status.value,
                    "isAvailable": room.status == RoomStatus.AVAILABLE,
                    "completedTrials": room.completed_trials,
                    "requiredTrials": room.required_trials
                }
    return {"error": "Room not in any active sequence"}
```

#### 4. PsychoPyå´ã®çµ±åˆ

å„éƒ¨å±‹ã®PsychoPyã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒã‚·ãƒ¼ã‚±ãƒ³ã‚¹çŠ¶æ…‹ã‚’ãƒã‚§ãƒƒã‚¯ï¼š

```python
# training_task_with_sequence.py
from compartment_hardware import CompartmentHardware
import requests

# ä¸­å¤®ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ã«æ¥ç¶š
ORCHESTRATOR_URL = "http://server-pc:8000"
ROOM_ID = "room1"  # ã“ã®éƒ¨å±‹ã®ID

hw = CompartmentHardware()

def check_if_available():
    """ã“ã®éƒ¨å±‹ãŒåˆ©ç”¨å¯èƒ½ã‹ç¢ºèª"""
    response = requests.get(f"{ORCHESTRATOR_URL}/rooms/{ROOM_ID}/sequence_status")
    data = response.json()
    return data.get("isAvailable", False)

def notify_trial_completed(sequence_id):
    """è©¦è¡Œå®Œäº†ã‚’ä¸­å¤®ã«é€šçŸ¥"""
    requests.post(
        f"{ORCHESTRATOR_URL}/sequences/{sequence_id}/trial_completed",
        params={"room_id": ROOM_ID}
    )

# ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ—
while True:
    # ã‚·ãƒ¼ã‚±ãƒ³ã‚¹çŠ¶æ…‹ã‚’ç¢ºèª
    if not check_if_available():
        print("ã“ã®éƒ¨å±‹ã¯ã¾ã åˆ©ç”¨ã§ãã¾ã›ã‚“ã€‚å¾…æ©Ÿä¸­...")
        core.wait(1.0)
        continue

    # å…¥å®¤å¾…ã¡
    if hw.check_entrance():
        rfid = hw.read_rfid()

        # èª²é¡Œå®Ÿè¡Œ
        for trial in range(10):
            # ... èª²é¡Œãƒ­ã‚¸ãƒƒã‚¯ ...

            # è©¦è¡Œå®Œäº†ã‚’é€šçŸ¥
            notify_trial_completed(sequence_id="seq_001")
```

#### 5. Webãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ç®¡ç†

ã‚ªãƒšãƒ¬ãƒ¼ã‚¿ãƒ¼ç”¨ã®Webãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«ä»¥ä¸‹ã®æ©Ÿèƒ½ã‚’è¿½åŠ ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ã‚·ãƒ¼ã‚±ãƒ³ã‚¹åˆ¶å¾¡ãƒ‘ãƒãƒ«                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [æ–°è¦ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ä½œæˆ]                            â”‚
â”‚                                                 â”‚
â”‚ ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚·ãƒ¼ã‚±ãƒ³ã‚¹: seq_001                   â”‚
â”‚ åå‰: 3éƒ¨å±‹é€£æºèª²é¡Œ                             â”‚
â”‚                                                 â”‚
â”‚ ã‚¹ãƒ†ãƒƒãƒ— 1/3                                    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ âœ… éƒ¨å±‹1 (Training) - å®Œäº† 10/10è©¦è¡Œ    â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚      â†“                                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ â–¶ éƒ¨å±‹3 (DelayMatch) - é€²è¡Œä¸­ 5/20è©¦è¡Œ  â”‚   â”‚
â”‚ â”‚    [ğŸ”” é€šçŸ¥æ¸ˆã¿]                        â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚      â†“                                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ ğŸ”’ éƒ¨å±‹2 (Reversal) - ãƒ­ãƒƒã‚¯ä¸­ 0/15è©¦è¡Œ â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                 â”‚
â”‚ [ã‚·ãƒ¼ã‚±ãƒ³ã‚¹åœæ­¢] [ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ç·¨é›†]               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ä½œæˆUI**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ–°è¦ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ä½œæˆ                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å: [3éƒ¨å±‹é€£æºèª²é¡Œ              ]     â”‚
â”‚                                                 â”‚
â”‚ ã‚¹ãƒ†ãƒƒãƒ—è¨­å®š:                                   â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚ â”‚ ã‚¹ãƒ†ãƒƒãƒ— 1                             â”‚       â”‚
â”‚ â”‚ éƒ¨å±‹: [room1 â–¼]  èª²é¡Œ: [Training â–¼]   â”‚       â”‚
â”‚ â”‚ å¿…è¦è©¦è¡Œæ•°: [10]                       â”‚       â”‚
â”‚ â”‚ â˜‘ åˆ©ç”¨å¯èƒ½æ™‚ã«é€šçŸ¥                    â”‚       â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚ â”‚ ã‚¹ãƒ†ãƒƒãƒ— 2                             â”‚       â”‚
â”‚ â”‚ éƒ¨å±‹: [room3 â–¼]  èª²é¡Œ: [DelayMatch â–¼] â”‚       â”‚
â”‚ â”‚ å¿…è¦è©¦è¡Œæ•°: [20]                       â”‚       â”‚
â”‚ â”‚ â˜‘ åˆ©ç”¨å¯èƒ½æ™‚ã«é€šçŸ¥                    â”‚       â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚ â”‚ ã‚¹ãƒ†ãƒƒãƒ— 3                             â”‚       â”‚
â”‚ â”‚ éƒ¨å±‹: [room2 â–¼]  èª²é¡Œ: [Reversal â–¼]   â”‚       â”‚
â”‚ â”‚ å¿…è¦è©¦è¡Œæ•°: [15]                       â”‚       â”‚
â”‚ â”‚ â˜‘ åˆ©ç”¨å¯èƒ½æ™‚ã«é€šçŸ¥                    â”‚       â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                 â”‚
â”‚ [+ ã‚¹ãƒ†ãƒƒãƒ—è¿½åŠ ]                                â”‚
â”‚                                                 â”‚
â”‚ [ã‚­ãƒ£ãƒ³ã‚»ãƒ«] [ã‚·ãƒ¼ã‚±ãƒ³ã‚¹é–‹å§‹]                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ã‚·ã‚¹ãƒ†ãƒ è¦æ¨¡

#### ã‚±ãƒ¼ã‚¸ãƒ»ãƒ‡ãƒã‚¤ã‚¹æ§‹æˆ

- **ã‚±ãƒ¼ã‚¸æ•°**: 5-10ã‚±ãƒ¼ã‚¸
- **1ã‚±ãƒ¼ã‚¸ã‚ãŸã‚Š**: ç´„4ãƒ‡ãƒã‚¤ã‚¹
- **1ãƒ‡ãƒã‚¤ã‚¹ã‚ãŸã‚Š**: 1PCï¼ˆC# Compartment.exe + PsychoPyèª²é¡Œã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼‰
- **åˆè¨ˆPCæ•°**: 20-40å°ï¼ˆ5ã‚±ãƒ¼ã‚¸Ã—4ãƒ‡ãƒã‚¤ã‚¹ ï½ 10ã‚±ãƒ¼ã‚¸Ã—4ãƒ‡ãƒã‚¤ã‚¹ï¼‰

#### ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ§‹æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ä¸­å¤®ã‚µãƒ¼ãƒãƒ¼PC          â”‚
â”‚   (FastAPI Orchestrator) â”‚
â”‚   192.168.1.100:8000     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚ LAN
    â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”
    â–¼           â–¼     â–¼     â–¼     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” ...  â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”
â”‚Cage1-PC1â”‚ â”‚C1-P2â”‚      â”‚C5-P3â”‚ â”‚C5-P4â”‚
â”‚:5001    â”‚ â”‚:5002â”‚      â”‚:5019â”‚ â”‚:5020â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜
  C#+Psy     C#+Psy        C#+Psy  C#+Psy
```

**ãƒãƒ¼ãƒˆç•ªå·å‰²ã‚Šå½“ã¦ä¾‹**:
- Cage1-PC1: `http://192.168.1.101:5001/api`
- Cage1-PC2: `http://192.168.1.102:5002/api`
- Cage1-PC3: `http://192.168.1.103:5003/api`
- Cage1-PC4: `http://192.168.1.104:5004/api`
- Cage2-PC1: `http://192.168.1.105:5005/api`
- ...

### å®Ÿè£…ä¸Šã®è€ƒæ…®ç‚¹

1. **çŠ¶æ…‹åŒæœŸ**: ä¸­å¤®ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ãŒã‚·ãƒ¼ã‚±ãƒ³ã‚¹çŠ¶æ…‹ã‚’æ°¸ç¶šåŒ–ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ã¾ãŸã¯DBï¼‰
2. **éšœå®³æ™‚ã®å¾©æ—§**: ã‚µãƒ¼ãƒãƒ¼å†èµ·å‹•æ™‚ã«çŠ¶æ…‹ã‚’å¾©å…ƒ
3. **ä¸¦åˆ—ã‚·ãƒ¼ã‚±ãƒ³ã‚¹**: è¤‡æ•°ã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã‚’åŒæ™‚å®Ÿè¡Œå¯èƒ½ï¼ˆç•°ãªã‚‹å€‹ä½“ãŒç•°ãªã‚‹ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã‚’å®Ÿæ–½ï¼‰
4. **å€‹ä½“ç®¡ç†**: RFIDâ†’å€‹ä½“IDâ†’ã‚·ãƒ¼ã‚±ãƒ³ã‚¹IDã®ãƒãƒƒãƒ”ãƒ³ã‚°
5. **é€šçŸ¥ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º**: éŸ³ãƒ•ã‚¡ã‚¤ãƒ«ã€ãƒ©ãƒ³ãƒ—ç‚¹æ»…ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è¨­å®šå¯èƒ½

## å®Ÿè£…ãƒ•ã‚§ãƒ¼ã‚º

### ãƒ•ã‚§ãƒ¼ã‚º1: APIã‚µãƒ¼ãƒãƒ¼æ§‹ç¯‰ï¼ˆ1-2é€±é–“ï¼‰

**ç›®çš„**: C#ã«REST APIæ©Ÿèƒ½ã‚’è¿½åŠ ã—ã€åŸºæœ¬çš„ãªãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢åˆ¶å¾¡ã‚’å…¬é–‹

**ä½œæ¥­å†…å®¹**:
1. æ–°è¦ASP.NET Core Web APIãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ `Compartment.HardwareAPI` ã‚’è¿½åŠ 
2. FormMainã«Kestrelã‚µãƒ¼ãƒãƒ¼èµ·å‹•ãƒ­ã‚¸ãƒƒã‚¯ã‚’è¿½åŠ 
3. åŸºæœ¬çš„ãªã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’å®Ÿè£…ï¼ˆSensor, Door, Lever, Feed, RFIDï¼‰
4. HardwareServiceã‚¯ãƒ©ã‚¹ã§FormMainã¨ã®é€£æº
5. **ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰å®Ÿè£…**:
   - `IoMicrochipDummyEx` ã‚¯ãƒ©ã‚¹ä½œæˆï¼ˆã‚»ãƒ³ã‚µãƒ¼çŠ¶æ…‹ã‚’ä¿æŒï¼‰
   - `RFIDReaderDummy` ã‚¯ãƒ©ã‚¹ä½œæˆï¼ˆãƒ€ãƒŸãƒ¼RFIDï¼‰
   - Preferencesç”»é¢ã«ã€ŒEnable Debug Modeã€è¿½åŠ 
   - `DebugController` å®Ÿè£…
6. Postmanã§å‹•ä½œç¢ºèª

**æˆæœç‰©**:
- å‹•ä½œã™ã‚‹APIã‚µãƒ¼ãƒãƒ¼ï¼ˆlocalhost:5000ï¼‰
- åŸºæœ¬çš„ãªã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼ˆã‚»ãƒ³ã‚µãƒ¼èª­ã¿å–ã‚Šã€ãƒ‰ã‚¢åˆ¶å¾¡ã€ãƒ¬ãƒãƒ¼åˆ¶å¾¡ã€çµ¦é¤Œã€RFIDï¼‰
- ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰æ©Ÿèƒ½

**æ¤œè¨¼æ–¹æ³•**:
- ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰OFF: å®Ÿæ©Ÿã§ `POST http://localhost:5000/api/door/open` ã§ãƒ‰ã‚¢ãŒé–‹ã
- ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ON: `POST http://localhost:5000/api/debug/sensor/set` ã§ã‚»ãƒ³ã‚µãƒ¼çŠ¶æ…‹å¤‰æ›´

### ãƒ•ã‚§ãƒ¼ã‚º2: Pythonã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼ˆ1é€±é–“ï¼‰

**ç›®çš„**: PsychoPyã‹ã‚‰ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã‚’åˆ¶å¾¡ã™ã‚‹ãŸã‚ã®Pythonãƒ©ã‚¤ãƒ–ãƒ©ãƒªä½œæˆ

**ä½œæ¥­å†…å®¹**:
1. `compartment_hardware.py` ã‚’ä½œæˆ
2. å„APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«å¯¾å¿œã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè£…
3. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã€ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå‡¦ç†ã‚’è¿½åŠ 
4. **ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰å¯¾å¿œ**:
   - `debug_mode` ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¿½åŠ 
   - `debug_set_sensor()`, `debug_set_rfid()` ãƒ¡ã‚½ãƒƒãƒ‰å®Ÿè£…
   - `debug_keyboard_control.py` ä½œæˆï¼ˆã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
5. ç°¡å˜ãªãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã§å‹•ä½œç¢ºèª

**æˆæœç‰©**:
- `CompartmentHardware` Pythonã‚¯ãƒ©ã‚¹
- ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰æ©Ÿèƒ½ä»˜ã
- ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
- ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ

**æ¤œè¨¼æ–¹æ³•**:
- ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰OFF: å®Ÿæ©Ÿã§ `hw.check_entrance()` ã§ã‚»ãƒ³ã‚µãƒ¼èª­ã¿å–ã‚Š
- ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ON: `hw.debug_simulate_entrance()` ã§å…¥å®¤ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
- ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œã§ã‚»ãƒ³ã‚µãƒ¼ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ

### ãƒ•ã‚§ãƒ¼ã‚º3: ExternalControlãƒ¢ãƒ¼ãƒ‰è¿½åŠ ï¼ˆ1é€±é–“ï¼‰

**ç›®çš„**: C#å´ã®èª²é¡Œåˆ¶å¾¡ã‚’ç„¡åŠ¹åŒ–ã—ã€å¤–éƒ¨åˆ¶å¾¡ã‚’å¯èƒ½ã«ã™ã‚‹ãƒ¢ãƒ¼ãƒ‰è¿½åŠ 

**ä½œæ¥­å†…å®¹**:
1. `ECpTask` åˆ—æŒ™å‹ã« `ExternalControl = 5` ã‚’è¿½åŠ 
2. OpCollection/UcOperationã®ã‚¹ãƒ†ãƒ¼ãƒˆãƒã‚·ãƒ³ã«ã‚¹ã‚­ãƒƒãƒ—ãƒ­ã‚¸ãƒƒã‚¯è¿½åŠ 
3. ExternalControlãƒ¢ãƒ¼ãƒ‰æ™‚ã«FormSubã‚’éè¡¨ç¤º
4. UIè¨­å®šç”»é¢ã«ã€ŒExternalControlã€ã‚’è¿½åŠ 

**æˆæœç‰©**:
- ExternalControlãƒ¢ãƒ¼ãƒ‰ãŒé¸æŠå¯èƒ½
- C#å´ã®ã‚¹ãƒ†ãƒ¼ãƒˆãƒã‚·ãƒ³ãŒç„¡åŠ¹åŒ–ã•ã‚Œã‚‹

**æ¤œè¨¼æ–¹æ³•**:
- Preferencesç”»é¢ã§ExternalControlã‚’é¸æŠå¯èƒ½
- Startãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã‚‚èª²é¡Œã‚¹ãƒ†ãƒ¼ãƒˆãƒã‚·ãƒ³ãŒå‹•ä½œã—ãªã„

### ãƒ•ã‚§ãƒ¼ã‚º4: ç°¡å˜ãªèª²é¡Œå®Ÿè£…ï¼ˆ1-2é€±é–“ï¼‰

**ç›®çš„**: PsychoPyã§å®Œå…¨ãªèª²é¡Œãƒ•ãƒ­ãƒ¼ã‚’å®Ÿè£…ã—ã€ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰æ¤œè¨¼

**ä½œæ¥­å†…å®¹**:
1. `training_task_example.py` ã‚’å®Ÿè£…
2. PsychoPyã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’ã‚»ã‚«ãƒ³ãƒ€ãƒªãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ã«è¨­å®š
3. å…¥å®¤æ¤œå‡ºâ†’RFIDâ†’èª²é¡Œâ†’çµ¦é¤Œâ†’é€€å®¤ã®å®Œå…¨ãƒ•ãƒ­ãƒ¼å®Ÿè£…
4. ãƒ‡ãƒ¼ã‚¿è¨˜éŒ²APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ `POST /api/log/write` ã‚’è¿½åŠ 
5. **ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ã§ã®å‹•ä½œç¢ºèª**:
   - ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã§å…¥å®¤/é€€å®¤ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
   - ãƒ€ãƒŸãƒ¼RFIDã‚’è‡ªå‹•ç”Ÿæˆ
   - ãƒ‡ãƒ¢ãƒ¢ãƒ¼ãƒ‰ã§å®Œå…¨ãƒ•ãƒ­ãƒ¼å®Ÿè¡Œ
6. å®Ÿæ©Ÿã§å‹•ä½œç¢ºèª

**æˆæœç‰©**:
- PsychoPyã§å‹•ä½œã™ã‚‹è¨“ç·´èª²é¡Œ
- ãƒ‡ãƒ¼ã‚¿è¨˜éŒ²æ©Ÿèƒ½
- ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰å¯¾å¿œ

**æ¤œè¨¼æ–¹æ³•**:
- ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰: PCå˜ä½“ã§èª²é¡Œãƒ•ãƒ­ãƒ¼ãŒå‹•ä½œ
- å®Ÿæ©Ÿãƒ¢ãƒ¼ãƒ‰: å®Ÿéš›ã®ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã§èª²é¡ŒãŒå®Ÿè¡Œã§ãã‚‹
- æ—¢å­˜CSVãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã§ãƒ‡ãƒ¼ã‚¿ãŒè¨˜éŒ²ã•ã‚Œã‚‹

### ãƒ•ã‚§ãƒ¼ã‚º5: æ—¢å­˜èª²é¡Œã®ç§»è¡Œï¼ˆ2-4é€±é–“ï¼‰

**ç›®çš„**: Trainingã€DelayMatchç­‰ã®æ—¢å­˜èª²é¡Œã‚’Pythonå®Ÿè£…ã«ç§»è¡Œ

**ä½œæ¥­å†…å®¹**:
1. Trainingèª²é¡Œã‚’Pythonå®Ÿè£… (`training_task.py`)
2. DelayMatchèª²é¡Œã‚’Pythonå®Ÿè£… (`delaymatch_task.py`)
3. ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®äº’æ›æ€§ç¢ºèª
4. æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã¨ã®æ¯”è¼ƒæ¤œè¨¼

**æˆæœç‰©**:
- æ—¢å­˜èª²é¡Œã¨åŒç­‰ã®Pythonå®Ÿè£…
- æ¤œè¨¼ãƒ¬ãƒãƒ¼ãƒˆ

### ãƒ•ã‚§ãƒ¼ã‚º6: ä¸­å¤®ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼å®Ÿè£…ï¼ˆ3-5é€±é–“ï¼‰ â­é‡è¦

**ç›®çš„**: è¤‡æ•°éƒ¨å±‹ã‚’çµ±åˆç®¡ç†ã—ã€æ¡ä»¶ä»˜ãã‚·ãƒ¼ã‚±ãƒ³ã‚¹åˆ¶å¾¡ã‚’å®Ÿç¾

**ä½œæ¥­å†…å®¹**:
1. **ä¸­å¤®ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ï¼ˆFastAPIï¼‰å®Ÿè£…**:
   - `CentralOrchestrator` Pythonãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ
   - éƒ¨å±‹ç®¡ç†APIå®Ÿè£…ï¼ˆrooms/, rooms/{room_id}/ï¼‰
   - ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ç®¡ç†APIå®Ÿè£…ï¼ˆsequences/ï¼‰
   - çŠ¶æ…‹æ°¸ç¶šåŒ–ï¼ˆJSON/SQLiteï¼‰

2. **C# APIæ‹¡å¼µ**:
   - APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã« `compartmentNo` / `roomId` è¿½åŠ 
   - Preferences ã« `ApiServerPort` ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£è¿½åŠ 
   - ãƒãƒ¼ãƒˆç•ªå·ã‚’éƒ¨å±‹ã”ã¨ã«è¨­å®šå¯èƒ½ã«

3. **ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼å®Ÿè£…**:
   - `SequenceManager` ã‚¯ãƒ©ã‚¹ï¼ˆçŠ¶æ…‹ç®¡ç†ï¼‰
   - æ¡ä»¶ä»˜ãé€²è¡Œãƒ­ã‚¸ãƒƒã‚¯ï¼ˆAå®Œäº†â†’Båˆ©ç”¨å¯èƒ½ï¼‰
   - éŸ³ãƒ»å…‰ã«ã‚ˆã‚‹é€šçŸ¥æ©Ÿèƒ½

4. **Webãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰å®Ÿè£…**:
   - FastAPI + React/Vue.js
   - ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ä½œæˆUI
   - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ çŠ¶æ…‹ç›£è¦–
   - ãƒ‡ãƒ¼ã‚¿å¯è¦–åŒ–

5. **PsychoPyå´ã®çµ±åˆ**:
   - `compartment_hardware.py` ã«ä¸­å¤®ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼é€£æºæ©Ÿèƒ½è¿½åŠ 
   - ã‚·ãƒ¼ã‚±ãƒ³ã‚¹çŠ¶æ…‹ãƒã‚§ãƒƒã‚¯
   - è©¦è¡Œå®Œäº†é€šçŸ¥

6. **ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­å®šãƒ»æ¤œè¨¼**:
   - è¤‡æ•°PCï¼ˆ20-40å°ï¼‰ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­å®š
   - ãƒãƒ¼ãƒˆç•ªå·å‰²ã‚Šå½“ã¦
   - ä¸­å¤®ã‚µãƒ¼ãƒãƒ¼ã¨ã®é€šä¿¡ç¢ºèª

**æˆæœç‰©**:
- å‹•ä½œã™ã‚‹ä¸­å¤®ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ï¼ˆFastAPIï¼‰
- Webãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
- æ¡ä»¶ä»˜ãã‚·ãƒ¼ã‚±ãƒ³ã‚¹åˆ¶å¾¡æ©Ÿèƒ½
- è¤‡æ•°éƒ¨å±‹ã§ã®å‹•ä½œæ¤œè¨¼ãƒ¬ãƒãƒ¼ãƒˆ

**æ¤œè¨¼æ–¹æ³•**:
- 3éƒ¨å±‹ã§ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å®Ÿè¡Œï¼ˆroom1â†’room3â†’room2ï¼‰
- å„éƒ¨å±‹ã§ã®éŸ³ãƒ»å…‰é€šçŸ¥ç¢ºèª
- ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ çŠ¶æ…‹ç›£è¦–
- 20-40å°è¦æ¨¡ã§ã®ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£æ¤œè¨¼

## é‡è¦ãªãƒ•ã‚¡ã‚¤ãƒ«

### å¤‰æ›´ãŒå¿…è¦ãªæ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«

1. **`/Users/terumi/Downloads/compartment/cs/Compartment/Compartment.sln`**
   - HardwareAPIãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’è¿½åŠ 

2. **`/Users/terumi/Downloads/compartment/cs/Compartment/Compartment/FormMain.cs`**
   - Kestrelã‚µãƒ¼ãƒãƒ¼èµ·å‹•ãƒ­ã‚¸ãƒƒã‚¯è¿½åŠ 
   - FormSubã®è¡¨ç¤º/éè¡¨ç¤ºåˆ¶å¾¡

3. **`/Users/terumi/Downloads/compartment/cs/Compartment/Compartment/PreferencesDat.cs`**
   - `ECpTask` åˆ—æŒ™å‹ã« `ExternalControl = 5` ã‚’è¿½åŠ 

4. **`/Users/terumi/Downloads/compartment/cs/Compartment/Compartment/OpCollection.cs`**
   - `Sequencer.Execute()` ã«ExternalControlãƒ¢ãƒ¼ãƒ‰ã®ã‚¹ã‚­ãƒƒãƒ—ãƒ­ã‚¸ãƒƒã‚¯è¿½åŠ 

5. **`/Users/terumi/Downloads/compartment/cs/Compartment/Compartment/UcOperation.cs`**
   - `OnOperationStateMachineProc()` ã«ExternalControlãƒ¢ãƒ¼ãƒ‰ã®ã‚¹ã‚­ãƒƒãƒ—ãƒ­ã‚¸ãƒƒã‚¯è¿½åŠ 

6. **`/Users/terumi/Downloads/compartment/cs/Compartment/Compartment/UserControlPreferencesTab.Designer.cs`**
   - `comboBoxTypeOfTask` ã«ã€ŒExternalControlã€é¸æŠè‚¢ã‚’è¿½åŠ 
   - **ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã€ŒEnable Debug Modeã€ã‚’è¿½åŠ ** â­NEW

7. **`/Users/terumi/Downloads/compartment/cs/Compartment/Compartment/PreferencesDat.cs`** â­NEW
   - `EnableDebugMode` ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’è¿½åŠ 

8. **`/Users/terumi/Downloads/compartment/cs/Compartment/Compartment/FormMain.cs`** â­æ‹¡å¼µ
   - ãƒ‡ãƒãƒƒã‚°ãƒ‘ãƒãƒ«è¡¨ç¤ºãƒ­ã‚¸ãƒƒã‚¯è¿½åŠ 
   - ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰æ™‚ã®ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆè¿½åŠ ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

### æ–°è¦ä½œæˆãƒ•ã‚¡ã‚¤ãƒ«

#### C#å´ï¼ˆCompartment.HardwareAPIãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆï¼‰

1. **`Compartment.HardwareAPI/Program.cs`**
   - ASP.NET Coreèµ·å‹•è¨­å®š

2. **`Compartment.HardwareAPI/Controllers/SensorController.cs`**
   - ã‚»ãƒ³ã‚µãƒ¼èª­ã¿å–ã‚ŠAPI

3. **`Compartment.HardwareAPI/Controllers/RFIDController.cs`**
   - RFIDèª­ã¿å–ã‚ŠAPI

4. **`Compartment.HardwareAPI/Controllers/DoorController.cs`**
   - ãƒ‰ã‚¢åˆ¶å¾¡API

5. **`Compartment.HardwareAPI/Controllers/LeverController.cs`**
   - ãƒ¬ãƒãƒ¼åˆ¶å¾¡API

6. **`Compartment.HardwareAPI/Controllers/FeedController.cs`**
   - çµ¦é¤Œåˆ¶å¾¡API

7. **`Compartment.HardwareAPI/Controllers/RoomController.cs`**
   - ãƒ«ãƒ¼ãƒ ãƒ©ãƒ³ãƒ—åˆ¶å¾¡API

8. **`Compartment.HardwareAPI/Controllers/SoundController.cs`**
   - éŸ³å£°å†ç”ŸAPI

9. **`Compartment.HardwareAPI/Controllers/LogController.cs`**
   - ãƒ‡ãƒ¼ã‚¿è¨˜éŒ²APIï¼ˆãƒ•ã‚§ãƒ¼ã‚º4ã§è¿½åŠ ï¼‰

10. **`Compartment.HardwareAPI/Controllers/DebugController.cs`** â­NEW
    - ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰å°‚ç”¨API

11. **`Compartment.HardwareAPI/Services/IHardwareService.cs`**
    - ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã‚µãƒ¼ãƒ“ã‚¹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹

12. **`Compartment.HardwareAPI/Services/HardwareService.cs`**
    - FormMainã¨ã®é€£æºãƒ­ã‚¸ãƒƒã‚¯

13. **`Compartment.HardwareAPI/Models/SensorStatus.cs`**
    - APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ¢ãƒ‡ãƒ«

14. **`Compartment.HardwareAPI/Models/DeviceCommand.cs`**
    - APIãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ¢ãƒ‡ãƒ«

#### C#å´ï¼ˆCompartmentãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ - ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ï¼‰

15. **`Compartment/IoMicrochipDummyEx.cs`** â­NEW
    - å®Œå…¨ãƒ€ãƒŸãƒ¼IOãƒœãƒ¼ãƒ‰ï¼ˆã‚»ãƒ³ã‚µãƒ¼çŠ¶æ…‹ã‚’ä¿æŒï¼‰

16. **`Compartment/IoHybridBoard.cs`** â­NEW
    - ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰IOãƒœãƒ¼ãƒ‰ï¼ˆå®Ÿæ©Ÿï¼‹æ‰‹å‹•ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆåˆ‡æ›¿ï¼‰

17. **`Compartment/RFIDReaderDummy.cs`** â­NEW
    - ãƒ€ãƒŸãƒ¼RFIDãƒªãƒ¼ãƒ€ãƒ¼

18. **`Compartment/UserControlDebugPanel.cs`** â­NEW
    - ãƒ‡ãƒãƒƒã‚°ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ«ï¼ˆãƒ¡ã‚¤ãƒ³ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤è¡¨ç¤ºã€ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ãƒ¢ãƒ¼ãƒ‰å¯¾å¿œï¼‰

19. **`Compartment/UserControlDebugPanel.Designer.cs`** â­NEW
    - ãƒ‡ãƒãƒƒã‚°ãƒ‘ãƒãƒ«UIå®šç¾©

20. **`Compartment/PreferencesDat.cs`** â­æ‹¡å¼µ
    - `DebugModeType` åˆ—æŒ™å‹è¿½åŠ ï¼ˆFullDummy / Hybridï¼‰

#### Pythonå´ï¼ˆPsychoPyèª²é¡Œã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼‰

1. **`compartment_hardware.py`**
   - ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼ˆãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰å¯¾å¿œã€ã‚·ãƒ¼ã‚±ãƒ³ã‚¹é€£æºæ©Ÿèƒ½è¿½åŠ ï¼‰

2. **`debug_keyboard_control.py`** â­NEW
   - ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã§ã‚»ãƒ³ã‚µãƒ¼ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ

3. **`training_task_example.py`**
   - è¨“ç·´èª²é¡Œã‚µãƒ³ãƒ—ãƒ«ï¼ˆãƒ•ã‚§ãƒ¼ã‚º4ï¼‰

4. **`training_task_debug.py`** â­NEW
   - è¨“ç·´èª²é¡Œï¼ˆãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ç‰ˆã€ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œï¼‰

5. **`training_task_with_sequence.py`** â­NEW
   - è¨“ç·´èª²é¡Œï¼ˆã‚·ãƒ¼ã‚±ãƒ³ã‚¹é€£æºç‰ˆã€ä¸­å¤®ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ã¨é€£æºï¼‰

6. **`delaymatch_task_example.py`**
   - DelayMatchèª²é¡Œã‚µãƒ³ãƒ—ãƒ«ï¼ˆãƒ•ã‚§ãƒ¼ã‚º5ï¼‰

#### Pythonå´ï¼ˆä¸­å¤®ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ï¼‰ â­NEW

7. **`CentralOrchestrator/main.py`**
   - FastAPIãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
   - éƒ¨å±‹ç®¡ç†APIã€ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ç®¡ç†API

8. **`CentralOrchestrator/sequence_manager.py`**
   - SequenceManagerã‚¯ãƒ©ã‚¹ï¼ˆã‚·ãƒ¼ã‚±ãƒ³ã‚¹çŠ¶æ…‹ç®¡ç†ï¼‰
   - æ¡ä»¶ä»˜ãé€²è¡Œãƒ­ã‚¸ãƒƒã‚¯
   - é€šçŸ¥æ©Ÿèƒ½

9. **`CentralOrchestrator/models.py`**
   - ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ï¼ˆSequence, RoomStep, RoomStatusï¼‰

10. **`CentralOrchestrator/database.py`**
    - çŠ¶æ…‹æ°¸ç¶šåŒ–ï¼ˆSQLite/JSONï¼‰
    - ãƒ‡ãƒ¼ã‚¿é›†ç´„æ©Ÿèƒ½

11. **`CentralOrchestrator/dashboard/`**
    - Webãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼ˆReact/Vue.jsï¼‰
    - ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ä½œæˆUIã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–UI

## APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆä»•æ§˜

### ã‚»ãƒ³ã‚µãƒ¼èª­ã¿å–ã‚Š

- **`GET /api/sensor/entrance`** - å…¥å®¤ã‚»ãƒ³ã‚µãƒ¼
  - ãƒ¬ã‚¹ãƒãƒ³ã‚¹: `{ "active": true, "timestamp": "2026-01-29T12:34:56Z" }`

- **`GET /api/sensor/exit`** - é€€å®¤ã‚»ãƒ³ã‚µãƒ¼
  - ãƒ¬ã‚¹ãƒãƒ³ã‚¹: `{ "active": false, "timestamp": "..." }`

- **`GET /api/sensor/stay`** - åœ¨å®¤ã‚»ãƒ³ã‚µãƒ¼
  - ãƒ¬ã‚¹ãƒãƒ³ã‚¹: `{ "active": true, "timestamp": "..." }`

- **`GET /api/sensor/lever`** - ãƒ¬ãƒãƒ¼SW
  - ãƒ¬ã‚¹ãƒãƒ³ã‚¹: `{ "pressed": false, "timestamp": "..." }`

### RFID

- **`GET /api/rfid/read`** - RFIDèª­ã¿å–ã‚Š
  - ãƒ¬ã‚¹ãƒãƒ³ã‚¹: `{ "id": "3920145000567278", "timestamp": "..." }`

- **`DELETE /api/rfid`** - RFIDå€¤ã‚¯ãƒªã‚¢
  - ãƒ¬ã‚¹ãƒãƒ³ã‚¹: `{ "success": true }`

### ãƒ‰ã‚¢åˆ¶å¾¡

- **`POST /api/door/open`** - ãƒ‰ã‚¢ã‚’é–‹ã
  - ãƒ¬ã‚¹ãƒãƒ³ã‚¹: `{ "success": true, "state": "opening" }`

- **`POST /api/door/close`** - ãƒ‰ã‚¢ã‚’é–‰ã˜ã‚‹
  - ãƒ¬ã‚¹ãƒãƒ³ã‚¹: `{ "success": true, "state": "closing" }`

- **`GET /api/door/status`** - ãƒ‰ã‚¢çŠ¶æ…‹å–å¾—
  - ãƒ¬ã‚¹ãƒãƒ³ã‚¹: `{ "state": "opened", "sensorOpen": true, "sensorClose": false }`

### ãƒ¬ãƒãƒ¼åˆ¶å¾¡

- **`POST /api/lever/extend`** - ãƒ¬ãƒãƒ¼ã‚’å‡ºã™
  - ãƒ¬ã‚¹ãƒãƒ³ã‚¹: `{ "success": true, "state": "extending" }`

- **`POST /api/lever/retract`** - ãƒ¬ãƒãƒ¼ã‚’å¼•ã£è¾¼ã‚ã‚‹
  - ãƒ¬ã‚¹ãƒãƒ³ã‚¹: `{ "success": true, "state": "retracting" }`

- **`POST /api/lever/lamp`** - ãƒ¬ãƒãƒ¼ãƒ©ãƒ³ãƒ—åˆ¶å¾¡
  - ãƒªã‚¯ã‚¨ã‚¹ãƒˆ: `{ "on": true }`
  - ãƒ¬ã‚¹ãƒãƒ³ã‚¹: `{ "success": true }`

### çµ¦é¤Œ

- **`POST /api/feed/dispense`** - çµ¦é¤Œå®Ÿè¡Œ
  - ãƒªã‚¯ã‚¨ã‚¹ãƒˆ: `{ "durationMs": 1000 }`
  - ãƒ¬ã‚¹ãƒãƒ³ã‚¹: `{ "success": true, "feeding": true }`

- **`POST /api/feed/lamp`** - çµ¦é¤Œãƒ©ãƒ³ãƒ—åˆ¶å¾¡
  - ãƒªã‚¯ã‚¨ã‚¹ãƒˆ: `{ "on": true }`
  - ãƒ¬ã‚¹ãƒãƒ³ã‚¹: `{ "success": true }`

- **`GET /api/feed/status`** - çµ¦é¤ŒçŠ¶æ…‹å–å¾—
  - ãƒ¬ã‚¹ãƒãƒ³ã‚¹: `{ "feeding": false }`

### ãƒ«ãƒ¼ãƒ 

- **`POST /api/room/lamp`** - ãƒ«ãƒ¼ãƒ ãƒ©ãƒ³ãƒ—åˆ¶å¾¡
  - ãƒªã‚¯ã‚¨ã‚¹ãƒˆ: `{ "on": true }`
  - ãƒ¬ã‚¹ãƒãƒ³ã‚¹: `{ "success": true }`

### éŸ³å£°

- **`POST /api/sound/play`** - éŸ³å£°å†ç”Ÿ
  - ãƒªã‚¯ã‚¨ã‚¹ãƒˆ: `{ "file": "/path/to/sound.wav", "durationMs": 500 }`
  - ãƒ¬ã‚¹ãƒãƒ³ã‚¹: `{ "success": true, "playing": true }`

### ãƒ‡ãƒ¼ã‚¿è¨˜éŒ²ï¼ˆãƒ•ã‚§ãƒ¼ã‚º4ã§è¿½åŠ ï¼‰

- **`POST /api/log/write`** - ãƒ‡ãƒ¼ã‚¿è¨˜éŒ²
  - ãƒªã‚¯ã‚¨ã‚¹ãƒˆ:
    ```json
    {
      "idCode": "3920145000567278",
      "result": "correct",
      "trialNumber": 5,
      "touchX": 123,
      "touchY": 456,
      "timestamp": "2026-01-29T12:34:56Z"
    }
    ```
  - ãƒ¬ã‚¹ãƒãƒ³ã‚¹: `{ "success": true }`

### ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰å°‚ç”¨API â­NEW

- **`POST /api/debug/sensor/set`** - ã‚»ãƒ³ã‚µãƒ¼çŠ¶æ…‹ã‚’è¨­å®š
  - ãƒªã‚¯ã‚¨ã‚¹ãƒˆ: `{ "sensor": "entrance", "state": true }`
  - ãƒ¬ã‚¹ãƒãƒ³ã‚¹: `{ "success": true }`
  - ä½¿ç”¨å¯èƒ½ãªã‚»ãƒ³ã‚µãƒ¼å: `"entrance"`, `"exit"`, `"stay"`, `"lever"`

- **`POST /api/debug/rfid/set`** - RFIDå€¤ã‚’è¨­å®š
  - ãƒªã‚¯ã‚¨ã‚¹ãƒˆ: `{ "id": "1234567890123456" }`
  - ãƒ¬ã‚¹ãƒãƒ³ã‚¹: `{ "success": true }`

- **`GET /api/debug/sensors/all`** - ã™ã¹ã¦ã®ã‚»ãƒ³ã‚µãƒ¼çŠ¶æ…‹ã‚’å–å¾—
  - ãƒ¬ã‚¹ãƒãƒ³ã‚¹:
    ```json
    {
      "entrance": false,
      "exit": false,
      "stay": false,
      "doorOpen": false,
      "doorClose": true,
      "leverIn": true,
      "leverOut": false,
      "leverSw": false
    }
    ```

- **`POST /api/debug/reset`** - ãƒ‡ãƒã‚¤ã‚¹çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
  - ãƒ¬ã‚¹ãƒãƒ³ã‚¹: `{ "success": true }`

### ä¸­å¤®ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼APIï¼ˆãƒ•ã‚§ãƒ¼ã‚º6ã§è¿½åŠ ï¼‰ â­NEW

ã“ã‚Œã‚‰ã®APIã¯ä¸­å¤®ã‚µãƒ¼ãƒãƒ¼ï¼ˆFastAPIï¼‰ãŒæä¾›ã—ã¾ã™ã€‚

#### éƒ¨å±‹ç®¡ç†

- **`GET /rooms`** - ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹éƒ¨å±‹ä¸€è¦§
  - ãƒ¬ã‚¹ãƒãƒ³ã‚¹: `{ "room1": {"url": "http://...", "name": "å®Ÿé¨“å®¤1"}, ... }`

- **`GET /rooms/{room_id}/sensors/all`** - ç‰¹å®šéƒ¨å±‹ã®å…¨ã‚»ãƒ³ã‚µãƒ¼çŠ¶æ…‹
  - ãƒ¬ã‚¹ãƒãƒ³ã‚¹: `{ "roomId": "room1", "entrance": {...}, "exit": {...}, ... }`

- **`GET /rooms/{room_id}/sequence_status`** - éƒ¨å±‹ã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹çŠ¶æ…‹
  - ãƒ¬ã‚¹ãƒãƒ³ã‚¹:
    ```json
    {
      "sequenceId": "seq_001",
      "status": "available",
      "isAvailable": true,
      "completedTrials": 5,
      "requiredTrials": 10
    }
    ```

#### ã‚·ãƒ¼ã‚±ãƒ³ã‚¹åˆ¶å¾¡

- **`POST /sequences/create`** - æ–°è¦ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ä½œæˆ
  - ãƒªã‚¯ã‚¨ã‚¹ãƒˆ:
    ```json
    {
      "sequenceId": "seq_001",
      "name": "3éƒ¨å±‹é€£æºèª²é¡Œ",
      "rooms": [
        {
          "order": 1,
          "roomId": "room1",
          "taskType": "training",
          "requiredTrials": 10,
          "notifyOnAvailable": true
        },
        ...
      ]
    }
    ```
  - ãƒ¬ã‚¹ãƒãƒ³ã‚¹: `{ "success": true, "sequenceId": "seq_001" }`

- **`GET /sequences/{sequence_id}/status`** - ã‚·ãƒ¼ã‚±ãƒ³ã‚¹çŠ¶æ…‹å–å¾—
  - ãƒ¬ã‚¹ãƒãƒ³ã‚¹:
    ```json
    {
      "sequenceId": "seq_001",
      "name": "3éƒ¨å±‹é€£æºèª²é¡Œ",
      "currentStep": 1,
      "totalSteps": 3,
      "rooms": [
        {
          "order": 1,
          "roomId": "room1",
          "taskType": "training",
          "status": "completed",
          "completedTrials": 10,
          "requiredTrials": 10
        },
        {
          "order": 2,
          "roomId": "room3",
          "taskType": "delaymatch",
          "status": "in_progress",
          "completedTrials": 5,
          "requiredTrials": 20
        },
        {
          "order": 3,
          "roomId": "room2",
          "taskType": "reversal",
          "status": "locked",
          "completedTrials": 0,
          "requiredTrials": 15
        }
      ]
    }
    ```

- **`POST /sequences/{sequence_id}/trial_completed`** - è©¦è¡Œå®Œäº†é€šçŸ¥
  - ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿: `room_id`
  - ãƒ¬ã‚¹ãƒãƒ³ã‚¹: `{ "success": true }`
  - èª¬æ˜: å„éƒ¨å±‹ã®PsychoPyã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒè©¦è¡Œå®Œäº†æ™‚ã«å‘¼ã³å‡ºã™

- **`DELETE /sequences/{sequence_id}`** - ã‚·ãƒ¼ã‚±ãƒ³ã‚¹åœæ­¢
  - ãƒ¬ã‚¹ãƒãƒ³ã‚¹: `{ "success": true }`

#### ãƒ‡ãƒ¼ã‚¿é›†ç´„

- **`GET /data/summary`** - å…¨éƒ¨å±‹ã®ãƒ‡ãƒ¼ã‚¿ã‚µãƒãƒªãƒ¼
  - ãƒ¬ã‚¹ãƒãƒ³ã‚¹:
    ```json
    {
      "room1": {"totalTrials": 150, "successRate": 0.85, ...},
      "room2": {"totalTrials": 200, "successRate": 0.78, ...},
      ...
    }
    ```

- **`GET /data/by_rfid/{rfid_id}`** - å€‹ä½“åˆ¥ãƒ‡ãƒ¼ã‚¿å–å¾—
  - ãƒ¬ã‚¹ãƒãƒ³ã‚¹: ç‰¹å®šå€‹ä½“ã®å…¨è©¦è¡Œå±¥æ­´

## é‡è¦ãªå®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³

### FormMainã¨ã®çµ±åˆï¼ˆKestrelã‚µãƒ¼ãƒãƒ¼èµ·å‹•ï¼‰

```csharp
// FormMain.cs
private IHost _apiHost;

private void StartApiServer()
{
    _apiHost = Host.CreateDefaultBuilder()
        .ConfigureWebHostDefaults(webBuilder =>
        {
            webBuilder.UseStartup<ApiStartup>();
            webBuilder.UseUrls("http://localhost:5000");
        })
        .Build();

    Task.Run(() => _apiHost.RunAsync());
}

// FormMain_Loadã‚¤ãƒ™ãƒ³ãƒˆã§å‘¼ã³å‡ºã—
private void FormMain_Load(object sender, EventArgs e)
{
    // æ—¢å­˜ã®åˆæœŸåŒ–å‡¦ç†...

    // APIã‚µãƒ¼ãƒãƒ¼èµ·å‹•
    StartApiServer();
}
```

### HardwareServiceã§ã®ã‚¹ãƒ¬ãƒƒãƒ‰ã‚»ãƒ¼ãƒ•ãªåˆ¶å¾¡

```csharp
// HardwareService.cs
public class HardwareService : IHardwareService
{
    private readonly FormMain _formMain;

    public HardwareService(FormMain formMain)
    {
        _formMain = formMain;
    }

    public async Task<bool> OpenDoorAsync()
    {
        var tcs = new TaskCompletionSource<bool>();
        _formMain.Invoke((MethodInvoker)(() =>
        {
            var cmdPkt = new DevCmdPkt { DevCmdVal = EDevCmd.DoorOpen };
            _formMain.concurrentQueueDevCmdPktDoor.Enqueue(cmdPkt);
            tcs.SetResult(true);
        }));
        return await tcs.Task;
    }
}
```

### ExternalControlãƒ¢ãƒ¼ãƒ‰ã®ã‚¹ã‚­ãƒƒãƒ—ãƒ­ã‚¸ãƒƒã‚¯

```csharp
// OpCollection.cs - Sequencerã‚¯ãƒ©ã‚¹å†…
public void Execute()
{
    // ExternalControlãƒ¢ãƒ¼ãƒ‰æ™‚ã¯ã‚¹ãƒ†ãƒ¼ãƒˆãƒã‚·ãƒ³ã‚’ã‚¹ã‚­ãƒƒãƒ—
    if (_preferences.OpeTypeOfTask == ECpTask.ExternalControl)
    {
        // ä½•ã‚‚ã—ãªã„ï¼ˆPsychoPyãŒåˆ¶å¾¡ï¼‰
        return;
    }

    // æ—¢å­˜ã®ã‚¹ãƒ†ãƒ¼ãƒˆãƒã‚·ãƒ³å‡¦ç†
    switch (State)
    {
        case EState.WaitingForEnterCage:
            // ...
    }
}
```

### FormSubã®è¡¨ç¤ºåˆ¶å¾¡

```csharp
// FormMain.cs
private void UpdateFormSubVisibility()
{
    if (preferencesDatOriginal.OpeTypeOfTask == ECpTask.ExternalControl)
    {
        formSub.Hide();
    }
    else
    {
        formSub.Show();
    }
}
```

## ãƒªã‚¹ã‚¯ã¨å¯¾ç­–

### ãƒªã‚¹ã‚¯1: REST APIã®ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·

**å•é¡Œ**: HTTPé€šä¿¡ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰ï¼ˆæ•°ms~æ•°åmsï¼‰ãŒãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ€§ã«å½±éŸ¿

**å¯¾ç­–**:
- ã‚»ãƒ³ã‚µãƒ¼ãƒãƒ¼ãƒªãƒ³ã‚°é–“éš”ã‚’100msç¨‹åº¦ã«è¨­å®š
- é‡è¦ãªã‚³ãƒãƒ³ãƒ‰ï¼ˆãƒ‰ã‚¢ã€ãƒ¬ãƒãƒ¼ï¼‰ã¯å³åº§ã«ã‚­ãƒ¥ãƒ¼ã«è¿½åŠ 
- å¿…è¦ã«å¿œã˜ã¦WebSocketå°å…¥ã‚’æ¤œè¨ï¼ˆãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šçŸ¥ï¼‰

### ãƒªã‚¹ã‚¯2: ã‚¹ãƒ¬ãƒƒãƒ‰ã‚»ãƒ¼ãƒ•

**å•é¡Œ**: Web APIã‚¹ãƒ¬ãƒƒãƒ‰ã¨BackgroundWorkerã‚¹ãƒ¬ãƒƒãƒ‰ã®ç«¶åˆ

**å¯¾ç­–**:
- `Invoke` ã‚’ä½¿ã£ã¦UIã‚¹ãƒ¬ãƒƒãƒ‰ã§å®Ÿè¡Œ
- `ConcurrentQueue` ã¯æ—¢ã«ã‚¹ãƒ¬ãƒƒãƒ‰ã‚»ãƒ¼ãƒ•
- ã‚»ãƒ³ã‚µãƒ¼çŠ¶æ…‹ã®èª­ã¿å–ã‚Šã¯ `SaveDIn()` å¾Œã®å€¤ã‚’ä½¿ç”¨

### ãƒªã‚¹ã‚¯3: å¾Œæ–¹äº’æ›æ€§

**å•é¡Œ**: æ—¢å­˜ã®èª²é¡ŒãŒå‹•ä½œã—ãªããªã‚‹

**å¯¾ç­–**:
- ExternalControlãƒ¢ãƒ¼ãƒ‰ã¯å®Œå…¨ã«ç‹¬ç«‹
- æ—¢å­˜ã®Trainingã€DelayMatchãƒ¢ãƒ¼ãƒ‰ã¯ä¸€åˆ‡å¤‰æ›´ã—ãªã„
- ãƒ‡ãƒ¼ã‚¿è¨˜éŒ²ã¯C#å´ã§æ—¢å­˜ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’ç¶­æŒ

### ãƒªã‚¹ã‚¯4: ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

**å•é¡Œ**: APIã‚µãƒ¼ãƒãƒ¼ãƒ€ã‚¦ãƒ³ã€ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã‚¨ãƒ©ãƒ¼ã€ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ

**å¯¾ç­–**:
- Pythonå´ã§ãƒªãƒˆãƒ©ã‚¤ãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£…
- ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®šï¼ˆ5ç§’ï¼‰
- ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°è¨˜éŒ²
- ãƒ•ã‚§ã‚¤ãƒ«ã‚»ãƒ¼ãƒ•ï¼ˆã‚¨ãƒ©ãƒ¼æ™‚ã¯ãƒ‰ã‚¢ã‚’é–‹ã‘ã¦çµ‚äº†ï¼‰

### ãƒªã‚¹ã‚¯5: PsychoPyã‚¦ã‚£ãƒ³ãƒ‰ã‚¦è¨­å®š

**å•é¡Œ**: ã‚»ã‚«ãƒ³ãƒ€ãƒªãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ã¸ã®è¡¨ç¤ºã€ã‚¿ãƒƒãƒå…¥åŠ›æ¤œå‡º

**å¯¾ç­–**:
- PsychoPyã® `screen=1` ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ã‚»ã‚«ãƒ³ãƒ€ãƒªãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤æŒ‡å®š
- `fullscr=True` ã§ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³è¡¨ç¤º
- `event.Mouse(win=win)` ã§ã‚¿ãƒƒãƒå…¥åŠ›å–å¾—
- äº‹å‰ã«ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤è¨­å®šã‚’ç¢ºèª

## è¤‡æ•°å®Ÿé¨“å®¤ã®çµ±åˆç®¡ç†ï¼ˆãƒ•ã‚§ãƒ¼ã‚º6ã§å®Ÿè£…ï¼‰

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

è¤‡æ•°ã®å®Ÿé¨“å®¤ï¼ˆ5-10ã‚±ãƒ¼ã‚¸ã€20-40å°PCï¼‰ã‚’ä¸­å¤®ã®ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ã‹ã‚‰çµ±åˆç®¡ç†ã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ï¼š

```
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   ä¸­å¤®ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼   â”‚
        â”‚     (Python/FastAPI)     â”‚
        â”‚  - è¤‡æ•°éƒ¨å±‹ã®çµ±åˆç®¡ç†      â”‚
        â”‚  - å®Ÿé¨“ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°    â”‚
        â”‚  - ãƒ‡ãƒ¼ã‚¿é›†ç´„ãƒ»åˆ†æ        â”‚
        â”‚  - Web UI ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚ HTTP REST API
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â–¼             â–¼             â–¼             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ éƒ¨å±‹1 APIâ”‚ â”‚ éƒ¨å±‹2 APIâ”‚ â”‚ éƒ¨å±‹3 APIâ”‚ â”‚ éƒ¨å±‹N APIâ”‚
â”‚(C# 5001) â”‚ â”‚(C# 5002) â”‚ â”‚(C# 5003) â”‚ â”‚(C# 500N) â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚            â”‚            â”‚            â”‚
     â–¼            â–¼            â–¼            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚PsychoPy 1â”‚ â”‚PsychoPy 2â”‚ â”‚PsychoPy 3â”‚ â”‚PsychoPy Nâ”‚
â”‚èª²é¡Œåˆ¶å¾¡   â”‚ â”‚èª²é¡Œåˆ¶å¾¡   â”‚ â”‚èª²é¡Œåˆ¶å¾¡   â”‚ â”‚èª²é¡Œåˆ¶å¾¡   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«è¨­è¨ˆã®ãƒã‚¤ãƒ³ãƒˆ

#### 1. ãƒãƒ¼ãƒˆç•ªå·ã®ä½“ç³»åŒ–

å„éƒ¨å±‹ã®C# APIã‚µãƒ¼ãƒãƒ¼ã¯ç•°ãªã‚‹ãƒãƒ¼ãƒˆã§èµ·å‹•ï¼š
- éƒ¨å±‹1: `http://localhost:5001/api`
- éƒ¨å±‹2: `http://localhost:5002/api`
- éƒ¨å±‹3: `http://localhost:5003/api`
- ...

**Preferencesè¨­å®šã«è¿½åŠ **:
```csharp
public int ApiServerPort { get; set; } = 5001;  // éƒ¨å±‹ã”ã¨ã«è¨­å®š
```

#### 2. éƒ¨å±‹è­˜åˆ¥å­ã®è¿½åŠ 

ã™ã¹ã¦ã®APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«éƒ¨å±‹IDã‚’å«ã‚ã‚‹ï¼š

```json
{
  "roomId": "room1",
  "sensor": "entrance",
  "active": true,
  "timestamp": "2026-01-29T12:34:56Z"
}
```

**APIãƒ¬ã‚¹ãƒãƒ³ã‚¹æ‹¡å¼µ**:
```csharp
public class ApiResponseBase
{
    public string RoomId { get; set; }  // CompartmentNoã‹ã‚‰å–å¾—
    public DateTime Timestamp { get; set; }
}
```

#### 3. ä¸­å¤®ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ï¼ˆPython/FastAPIï¼‰

**æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ**: `CentralOrchestrator` (Python)

```python
# central_orchestrator/main.py
from fastapi import FastAPI
from typing import List, Dict
import httpx

app = FastAPI()

# éƒ¨å±‹ã®è¨­å®š
ROOMS = {
    "room1": {"url": "http://localhost:5001/api", "name": "å®Ÿé¨“å®¤1"},
    "room2": {"url": "http://localhost:5002/api", "name": "å®Ÿé¨“å®¤2"},
    "room3": {"url": "http://localhost:5003/api", "name": "å®Ÿé¨“å®¤3"},
}

@app.get("/rooms")
async def list_rooms():
    """ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹éƒ¨å±‹ä¸€è¦§"""
    return ROOMS

@app.get("/rooms/{room_id}/sensors/all")
async def get_room_sensors(room_id: str):
    """ç‰¹å®šéƒ¨å±‹ã®å…¨ã‚»ãƒ³ã‚µãƒ¼çŠ¶æ…‹å–å¾—"""
    room = ROOMS.get(room_id)
    if not room:
        return {"error": "Room not found"}

    async with httpx.AsyncClient() as client:
        # å„ã‚»ãƒ³ã‚µãƒ¼ã‚’ä¸¦åˆ—å–å¾—
        entrance = await client.get(f"{room['url']}/sensor/entrance")
        exit = await client.get(f"{room['url']}/sensor/exit")
        # ...

    return {
        "roomId": room_id,
        "entrance": entrance.json(),
        "exit": exit.json(),
        # ...
    }

@app.get("/sensors/entrance/all")
async def get_all_entrance_sensors():
    """å…¨éƒ¨å±‹ã®å…¥å®¤ã‚»ãƒ³ã‚µãƒ¼çŠ¶æ…‹ã‚’å–å¾—"""
    results = {}
    async with httpx.AsyncClient() as client:
        for room_id, room in ROOMS.items():
            try:
                response = await client.get(f"{room['url']}/sensor/entrance")
                results[room_id] = response.json()
            except Exception as e:
                results[room_id] = {"error": str(e)}
    return results

@app.post("/rooms/{room_id}/feed/dispense")
async def dispense_feed(room_id: str, duration_ms: int):
    """ç‰¹å®šéƒ¨å±‹ã®çµ¦é¤Œ"""
    room = ROOMS.get(room_id)
    if not room:
        return {"error": "Room not found"}

    async with httpx.AsyncClient() as client:
        response = await client.post(
            f"{room['url']}/feed/dispense",
            json={"durationMs": duration_ms}
        )
        return response.json()

@app.post("/feed/dispense/all")
async def dispense_feed_all(duration_ms: int):
    """å…¨éƒ¨å±‹ã§åŒæ™‚çµ¦é¤Œï¼ˆåŒæœŸå®Ÿé¨“ç”¨ï¼‰"""
    results = {}
    async with httpx.AsyncClient() as client:
        tasks = []
        for room_id, room in ROOMS.items():
            task = client.post(
                f"{room['url']}/feed/dispense",
                json={"durationMs": duration_ms}
            )
            tasks.append((room_id, task))

        # ä¸¦åˆ—å®Ÿè¡Œ
        for room_id, task in tasks:
            results[room_id] = (await task).json()

    return results

@app.get("/data/summary")
async def get_data_summary():
    """å…¨éƒ¨å±‹ã®ãƒ‡ãƒ¼ã‚¿ã‚µãƒãƒªãƒ¼"""
    # å„éƒ¨å±‹ã®ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é›†ç´„
    # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰çµ±è¨ˆæƒ…å ±ã‚’å–å¾—
    pass
```

#### 4. Webãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

**FastAPI + React/Vue.js**:
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§å…¨éƒ¨å±‹ã®çŠ¶æ…‹ã‚’ç›£è¦–
- ã‚°ãƒ©ãƒ•ã‚£ã‚«ãƒ«ãªå®Ÿé¨“ç®¡ç†UI
- ãƒ‡ãƒ¼ã‚¿å¯è¦–åŒ–ï¼ˆæˆåŠŸç‡ã€è©¦è¡Œå›æ•°ç­‰ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å®Ÿé¨“å®¤çµ±åˆç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ éƒ¨å±‹1: â— å®Ÿé¨“ä¸­ (è©¦è¡Œ 5/20)          â”‚
â”‚   å…¥å®¤: â—‹  é€€å®¤: â—‹  çµ¦é¤Œ: â—‹         â”‚
â”‚   RFID: 3920145000567278           â”‚
â”‚                                     â”‚
â”‚ éƒ¨å±‹2: â—‹ å¾…æ©Ÿä¸­                     â”‚
â”‚   å…¥å®¤: â—‹  é€€å®¤: â—‹  çµ¦é¤Œ: â—‹         â”‚
â”‚                                     â”‚
â”‚ éƒ¨å±‹3: â— å®Ÿé¨“ä¸­ (è©¦è¡Œ 12/20)         â”‚
â”‚   å…¥å®¤: â—  é€€å®¤: â—‹  çµ¦é¤Œ: â—‹         â”‚
â”‚   RFID: 1234567890123456           â”‚
â”‚                                     â”‚
â”‚ [å…¨éƒ¨å±‹ã§çµ¦é¤Œ] [å…¨éƒ¨å±‹ãƒªã‚»ãƒƒãƒˆ]      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 5. ãƒ‡ãƒ¼ã‚¿é›†ç´„ãƒ»åˆ†æ

**ä¸­å¤®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰**:
- PostgreSQL / MongoDB ã§å…¨éƒ¨å±‹ã®ãƒ‡ãƒ¼ã‚¿ã‚’é›†ç´„
- éƒ¨å±‹é–“æ¯”è¼ƒåˆ†æ
- å€‹ä½“è¿½è·¡ï¼ˆRFIDï¼‰

```python
# central_orchestrator/database.py
from sqlalchemy import create_engine, Column, Integer, String, DateTime, Boolean
from sqlalchemy.ext.declarative import declarative_base

Base = declarative_base()

class Trial(Base):
    __tablename__ = 'trials'

    id = Column(Integer, primary_key=True)
    room_id = Column(String)
    rfid = Column(String)
    result = Column(String)  # correct, timeout, etc.
    trial_number = Column(Integer)
    timestamp = Column(DateTime)
    # ...

# å„éƒ¨å±‹ã®C# APIã‹ã‚‰ POST /api/log/write ã‚’å—ã‘ã¦é›†ç´„
```

#### 6. å®Ÿè£…ã‚¿ã‚¤ãƒŸãƒ³ã‚°

**ãƒ•ã‚§ãƒ¼ã‚º6ã§å®Ÿè£…** - ä¸Šè¨˜ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã€Œãƒ•ã‚§ãƒ¼ã‚º6: ä¸­å¤®ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼å®Ÿè£…ã€ã‚’å‚ç…§

ã“ã®æ©Ÿèƒ½ã¯æœ¬è¨ˆç”»ã®ä¸€éƒ¨ã¨ã—ã¦å®Ÿè£…ã—ã¾ã™ï¼ˆå°†æ¥ã®æ‹¡å¼µã§ã¯ãªãã€åˆæœŸãƒªãƒªãƒ¼ã‚¹ã«å«ã‚€ï¼‰ã€‚

### ç¾è¨ˆç”»ã¸ã®å½±éŸ¿

**ä»Šå›ã®å®Ÿè£…ï¼ˆãƒ•ã‚§ãƒ¼ã‚º1-5ï¼‰ã§è€ƒæ…®ã™ã¹ãç‚¹**:

1. âœ… **ãƒãƒ¼ãƒˆç•ªå·ã‚’è¨­å®šå¯èƒ½ã«**
   - Preferences ã« `ApiServerPort` è¿½åŠ 
   - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 5000ï¼ˆå°†æ¥ã¯éƒ¨å±‹ç•ªå·ã«å¿œã˜ã¦å¤‰æ›´ï¼‰

2. âœ… **RoomID/CompartmentNoã‚’ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«å«ã‚ã‚‹**
   - å…¨APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã« `compartmentNo` ã¾ãŸã¯ `roomId` ã‚’è¿½åŠ 
   - å°†æ¥ã®çµ±åˆç®¡ç†ã«å‚™ãˆã‚‹

3. âœ… **APIã®ç‹¬ç«‹æ€§ã‚’ä¿ã¤**
   - å„éƒ¨å±‹ã®C# APIã¯å®Œå…¨ã«ç‹¬ç«‹ã—ã¦å‹•ä½œ
   - ä¸­å¤®ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ãªã—ã§ã‚‚å˜ä½“å‹•ä½œå¯èƒ½

4. âœ… **ãƒ­ã‚°ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®çµ±ä¸€**
   - éƒ¨å±‹é–“ã§ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’çµ±ä¸€
   - å°†æ¥ã®é›†ç´„ã‚’å®¹æ˜“ã«

### ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£ã®ãƒ¡ãƒªãƒƒãƒˆ

1. **æ®µéšçš„æ‹¡å¼µ**: 1éƒ¨å±‹ã‹ã‚‰é–‹å§‹ã€å¿…è¦ã«å¿œã˜ã¦æ‹¡å¼µ
2. **ä¸¦åˆ—å®Ÿé¨“**: è¤‡æ•°éƒ¨å±‹ã§åŒæ™‚ã«ç•°ãªã‚‹èª²é¡Œã‚’å®Ÿæ–½
3. **åŒæœŸå®Ÿé¨“**: å…¨éƒ¨å±‹ã§åŒã˜ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§åˆ¶å¾¡ï¼ˆç¾¤å®Ÿé¨“ï¼‰
4. **ãƒ‡ãƒ¼ã‚¿çµ±åˆ**: éƒ¨å±‹é–“æ¯”è¼ƒã€å€‹ä½“è¿½è·¡
5. **åŠ¹ç‡åŒ–**: ä¸­å¤®ã‹ã‚‰ä¸€æ‹¬ç®¡ç†ã€å®Ÿé¨“è¨­å®šã®å…±æœ‰

## æˆåŠŸã®æŒ‡æ¨™

- âœ… PsychoPyã‹ã‚‰å…¨ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã‚’åˆ¶å¾¡å¯èƒ½
- âœ… æ—¢å­˜èª²é¡Œï¼ˆTraining, DelayMatchï¼‰ãŒå¼•ãç¶šãå‹•ä½œ
- âœ… ãƒ‡ãƒ¼ã‚¿ãŒæ—¢å­˜CSVãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã§è¨˜éŒ²ã•ã‚Œã‚‹
- âœ… APIçµŒç”±ã®åˆ¶å¾¡ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãŒ50msä»¥ä¸‹
- âœ… æ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ ExternalControl ãƒ¢ãƒ¼ãƒ‰ã‚’é¸æŠå¯èƒ½
- âœ… **å°†æ¥ã®è¤‡æ•°å®Ÿé¨“å®¤çµ±åˆã«å¯¾å¿œå¯èƒ½ãªè¨­è¨ˆ** â­NEW

## å®Ÿè£…ã®å„ªå…ˆé †ä½

### æ¨å¥¨å®Ÿè£…é †åº

1. **ãƒ•ã‚§ãƒ¼ã‚º1-3**: ã¾ãšå˜ä¸€éƒ¨å±‹ã§ã®PsychoPyçµ±åˆã‚’å®Œæˆã•ã›ã‚‹
   - APIã‚µãƒ¼ãƒãƒ¼æ§‹ç¯‰
   - Pythonã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ©ã‚¤ãƒ–ãƒ©ãƒª
   - ExternalControlãƒ¢ãƒ¼ãƒ‰

2. **ãƒ•ã‚§ãƒ¼ã‚º4**: ç°¡å˜ãªèª²é¡Œã§å‹•ä½œç¢ºèª
   - å®Œå…¨ãªãƒ•ãƒ­ãƒ¼å®Ÿè£…
   - ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰æ¤œè¨¼

3. **ãƒ•ã‚§ãƒ¼ã‚º5**: æ—¢å­˜èª²é¡Œã®ç§»è¡Œ
   - Training, DelayMatchç­‰ã®Pythonå®Ÿè£…

4. **ãƒ•ã‚§ãƒ¼ã‚º6**: è¤‡æ•°éƒ¨å±‹çµ±åˆï¼ˆæœ€å¾Œã«å®Ÿè£…ï¼‰
   - ä¸­å¤®ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼
   - æ¡ä»¶ä»˜ãã‚·ãƒ¼ã‚±ãƒ³ã‚¹åˆ¶å¾¡

### æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ï¼ˆãƒ•ã‚§ãƒ¼ã‚º1é–‹å§‹ï¼‰

1. ãƒ•ã‚§ãƒ¼ã‚º1ã®å®Ÿè£…é–‹å§‹
2. `Compartment.HardwareAPI` ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ
3. åŸºæœ¬çš„ãªã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼å®Ÿè£…ï¼ˆSensor, Doorï¼‰
4. FormMainã«Kestrelèµ·å‹•ãƒ­ã‚¸ãƒƒã‚¯è¿½åŠ 
5. **APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«CompartmentNoè¿½åŠ **
6. **Preferences ã«ApiServerPortè¿½åŠ **
7. ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰å®Ÿè£…ï¼ˆIoMicrochipDummyEx, IoHybridBoardï¼‰
8. ãƒ‡ãƒãƒƒã‚°ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ«å®Ÿè£…
9. Postmanã§å‹•ä½œç¢ºèª
